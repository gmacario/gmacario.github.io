{"pageProps":{"post":{"title":"Deploying a Node.JS application on Kubernetes using Jenkins X","content":"<!-- markdown-link-check-disable -->\n\n<h3 id=\"introduction\">Introduction</h3>\n<p>This article explains how to deploy a simple <a href=\"https://nodejs.org/\">Node.JS</a> application on a <a href=\"https://kubernetes.io/\">Kubernetes</a> cluster using <a href=\"https://jenkins-x.io/\">Jenkins X</a>.</p>\n<p>This post is the follow-up to my previous article <a href=\"https://gmacario.github.io/howto/kubernetes/gcp/jenkins/2018/10/09/install-jenkinsx-on-gcp.html\">Installing Jenkins X on Google Cloud Platform</a>.</p>\n<p>The following instructions have been tested on host &quot;nemo&quot; (Ubuntu 18.04.1 LTS 64-bit).</p>\n<p>We will create our sample application using Jenkins X Quickstart. Quickstarts are pre-made applications you can start a project from, instead of starting from scratch.</p>\n<h3 id=\"references\">References</h3>\n<ul>\n<li><a href=\"https://jenkins-x.io/getting-started/\">https://jenkins-x.io/getting-started/</a></li>\n<li><a href=\"https://gmacario.github.io/howto/kubernetes/gcp/jenkins/2018/10/09/install-jenkinsx-on-gcp.html\">https://gmacario.github.io/howto/kubernetes/gcp/jenkins/2018/10/09/install-jenkinsx-on-gcp.html</a></li>\n</ul>\n<h3 id=\"prerequisites\">Prerequisites</h3>\n<ul>\n<li>The <code>jx</code> binary is installed and available from your shell</li>\n<li>Jenkins X properly configured</li>\n</ul>\n<p>Browse <a href=\"https://console.cloud.google.com/\">https://console.cloud.google.com/</a></p>\n<p>Select the proper GCP project (in our case, <code>kubernetes-workshop-218213</code>)</p>\n<p>Click on the &quot;Activate Cloud Shell&quot; icon.</p>\n<h4 id=\"reinstalling-the-jx-binary\">Reinstalling the <code>jx</code> binary</h4>\n<!-- 2018-10-15 12:21 CEST -->\n\n<p>Type the following commands in case the <code>jx</code> command was not properly installed:</p>\n<pre><code class=\"language-shell\">mkdir -p ~/.jx/bin\ncurl -L \\\n  https://github.com/jenkins-x/jx/releases/download/v1.3.431/jx-linux-amd64.tar.gz \\\n  | tar xzv -C ~/.jx/bin\nexport PATH=$PATH:~/.jx/bin\necho &#39;export PATH=$PATH:~/.jx/bin&#39; &gt;&gt; ~/.bashrc\n</code></pre>\n<h4 id=\"verify-that-jx-is-correctly-configured\">Verify that jx is correctly configured</h4>\n<!-- 2018-10-15 16:17 CEST -->\n\n<pre><code class=\"language-shell\">jx status\n</code></pre>\n<p>Expected output:</p>\n<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ jx status\nJenkins X checks passed for Cluster(gke_kubernetes-workshop-218213_europe-west1-b_howlernoon): 3 nodes, memory 15% of 17354292Ki, cpu 41% of 5790m. Jenkins is running at http://jenkins.jx.35.195.140.178.nip.io\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n</code></pre>\n<!-- 2018-10-15 16:18 CEST -->\n\n<pre><code class=\"language-shell\">jx diagnose\n</code></pre>\n<p>Expected output:</p>\n<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ jx diagnose\nRunning in namespace: jx\nJenkins X Version:\n Using helmBinary helm with feature flag: none\nNAME               VERSION\njx                 1.3.431\njenkins x platform 0.0.2765\nKubernetes cluster v1.9.7-gke.6\nkubectl            v1.10.7\nhelm client        v2.10.0+g9ad53aa\nhelm server        v2.10.0+g9ad53aa\ngit                git version 2.11.0\n\nJenkins X Status:\n Jenkins X checks passed for Cluster(gke_kubernetes-workshop-218213_europe-west1-b_howlernoon): 3 nodes, memory 15% of 17354292Ki, cpu 41% of 5790m. Jenkins is running at http://jenkins.jx.35.195.140.178.nip.io\n\nKubernetes PVCs:\n NAME                        STATUS    VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\njenkins                     Bound     pvc-59d7abdc-d065-11e8-8172-42010a8401ee   30Gi       RWO            standard       3h\njenkins-x-chartmuseum       Bound     pvc-59d670d0-d065-11e8-8172-42010a8401ee   8Gi        RWO            standard       3h\njenkins-x-docker-registry   Bound     pvc-59d72bce-d065-11e8-8172-42010a8401ee   100Gi      RWO            standard       3h\njenkins-x-mongodb           Bound     pvc-59d90e70-d065-11e8-8172-42010a8401ee   8Gi        RWO            standard       3h\njenkins-x-nexus             Bound     pvc-59da88d9-d065-11e8-8172-42010a8401ee   8Gi        RWO            standard       3h\n\nKubernetes Pods:\n NAME                                            READY     STATUS    RESTARTS   AGE\njenkins-5dcf5bcd85-7xflw                        1/1       Running   0          3h\njenkins-x-chartmuseum-645d78c798-fckz4          1/1       Running   0          3h\njenkins-x-controllerteam-858ff8c6b8-m728p       1/1       Running   0          3h\njenkins-x-controllerworkflow-595d54767-fqvqd    1/1       Running   0          3h\njenkins-x-docker-registry-dcb6d6d44-2xcvn       1/1       Running   0          3h\njenkins-x-heapster-96bd95dcf-kdgjj              2/2       Running   0          3h\njenkins-x-mongodb-968b595dd-ngjpg               1/1       Running   1          3h\njenkins-x-monocular-api-6cff5d65df-9wwgq        1/1       Running   2          3h\njenkins-x-monocular-prerender-6d8897856-dx4kq   1/1       Running   0          3h\njenkins-x-monocular-ui-6b7645b67-w8qt6          1/1       Running   0          3h\njenkins-x-nexus-55f87888dc-b5l59                1/1       Running   0          3h\n\nKubernetes Ingresses:\n NAME              HOSTS                                      ADDRESS          PORTS     AGE\nchartmuseum       chartmuseum.jx.35.195.140.178.nip.io       35.233.119.214   80        3h\ndocker-registry   docker-registry.jx.35.195.140.178.nip.io   35.233.119.214   80        3h\njenkins           jenkins.jx.35.195.140.178.nip.io           35.233.119.214   80        3h\nmonocular         monocular.jx.35.195.140.178.nip.io         35.233.119.214   80        3h\nnexus             nexus.jx.35.195.140.178.nip.io             35.233.119.214   80        3h\n\nKubernetes Secrets:\n NAME                                       TYPE                                  DATA      AGE\ncleanup-token-bql7k                        kubernetes.io/service-account-token   3         3h\ndefault-token-g42q9                        kubernetes.io/service-account-token   3         3h\nexpose-token-6dlll                         kubernetes.io/service-account-token   3         3h\njenkins                                    Opaque                                3         3h\njenkins-docker-cfg                         Opaque                                1         3h\njenkins-git-credentials                    Opaque                                1         3h\njenkins-git-ssh                            Opaque                                2         3h\njenkins-hub-api-token                      Opaque                                1         3h\njenkins-maven-settings                     Opaque                                1         3h\njenkins-npm-token                          Opaque                                1         3h\njenkins-release-gpg                        Opaque                                4         3h\njenkins-ssh-config                         Opaque                                1         3h\njenkins-token-929mw                        kubernetes.io/service-account-token   3         3h\njenkins-x-chartmuseum                      Opaque                                2         3h\njenkins-x-controllerteam-token-m4dsz       kubernetes.io/service-account-token   3         3h\njenkins-x-controllerworkflow-token-vbzsm   kubernetes.io/service-account-token   3         3h\njenkins-x-docker-registry-secret           Opaque                                1         3h\njenkins-x-mongodb                          Opaque                                1         3h\njx-basic-auth                              Opaque                                1         3h\njx-install-config                          Opaque                                3         3h\njx-pipeline-git-github-github              Opaque                                2         3h\nnexus                                      Opaque                                1         3h\n\nPlease visit https://jenkins-x.io/faq/issues/ for any known issues.\nFinished printing diagnostic information.\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n</code></pre>\n<h3 id=\"create-quickstart-application-node-http-hmi-repository\">Create quickstart application <code>node-http-hmi-repository</code></h3>\n<!-- 2018-10-12 16:51CEST -->\n\n<p>Reference: <a href=\"https://jenkins-x.io/developing/create-quickstart/\">https://jenkins-x.io/developing/create-quickstart/</a></p>\n<p>Logged as <code>gmacario@cloudshell</code></p>\n<pre><code class=\"language-shell\">jx create quickstart\n</code></pre>\n<p>Result</p>\n<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ jx create quickstart\n? select the quickstart you wish to create  [Use arrows to move, type to filter]\n&gt; android-quickstart\n  angular-io-quickstart\n  aspnet-app\n  dlang-http\n  golang-http\n  jenkins-cwp-quickstart\n  jenkins-quickstart\n</code></pre>\n<p>Select <code>node-http</code></p>\n<pre><code>? select the quickstart you wish to create node-http\n? Project name (node-http)\n</code></pre>\n<p>Type <code>node-http-hmi-repository</code></p>\n<pre><code>? Project name node-http-hmi-repository\nGenerated quickstart at /home/gmacario/node-http-hmi-repository\n ### NO charts folder /home/gmacario/node-http-hmi-repository/charts/node-http\nCreated project at /home/gmacario/node-http-hmi-repository\n\nNo username defined for the current Git server!\n? Do you wish to use gmacario as the Git user name: (Y/n)\n</code></pre>\n<p>Type <code>Y</code></p>\n<pre><code>? Do you wish to use gmacario as the Git user name: Yes\nThe directory /home/gmacario/node-http-hmi-repository is not yet using git\n? Would you like to initialise git now? (Y/n)\n</code></pre>\n<p>Type <code>Y</code></p>\n<pre><code>? Would you like to initialise git now? Yes\n? Commit message:  (Initial import)\n</code></pre>\n<p>Accept default</p>\n<pre><code>? Commit message:  Initial import\n\nGit repository created\nperforming pack detection in folder /home/gmacario/node-http-hmi-repository\n--&gt; Draft detected JavaScript (36.530078%)\nselected pack: /home/gmacario/.jx/draft/packs/github.com/jenkins-x/draft-packs/packs/javascript\nreplacing placeholders in directory /home/gmacario/node-http-hmi-repository\napp name: node-http-hmi-repository, git server: github.com, org: gmacario, Docker registry org: gmacario\nskipping directory &quot;/home/gmacario/node-http-hmi-repository/.git&quot;\nUsing Git provider GitHub at https://github.com\n\n\nAbout to create repository node-http-hmi-repository on server https://github.com with user gmacario\n? Which organisation do you want to use?  [Use arrows to move, type to filter]\n  SOLARMA\n  TorinoTech\n  arolgroup\n&gt; gmacario\n  hackafake\n  kuruho\n  robotrokers\n</code></pre>\n<p>Select gmacario</p>\n<pre><code>? Which organisation do you want to use? gmacario\n? Enter the new repository name:  (node-http-hmi-repository)\n</code></pre>\n<p>Accept default</p>\n<pre><code>? Enter the new repository name:  node-http-hmi-repository\n\n\nCreating repository gmacario/node-http-hmi-repository\nPushed Git repository to https://github.com/gmacario/node-http-hmi-repository\n\nCreated Jenkins Project: http://jenkins.jx.35.195.52.165.nip.io/job/gmacario/job/node-http-hmi-repository/\n\nWatch pipeline activity via:    jx get activity -f node-http-hmi-repository -w\nBrowse the pipeline log via:    jx get build logs gmacario/node-http-hmi-repository/master\nOpen the Jenkins console via    jx console\nYou can list the pipelines via: jx get pipelines\nWhen the pipeline is complete:  jx get applications\n\nFor more help on available commands see: https://jenkins-x.io/developing/browsing/\n\nNote that your first pipeline may take a few minutes to start while the necessary images get downloaded!\n\nCreating GitHub webhook for gmacario/node-http-hmi-repository for url http://jenkins.jx.35.195.52.165.nip.io/github-webhook/\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n</code></pre>\n<h4 id=\"run-jx-status\">Run <code>jx status</code></h4>\n<!-- 2018-10-15 16:21 CEST -->\n\n<p>Command</p>\n<pre><code class=\"language-shell\">jx status\n</code></pre>\n<p>Result</p>\n<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ jx status\nJenkins X checks passed for Cluster(gke_kubernetes-workshop-218213_europe-west1-b_howlernoon): 3 nodes, memory 15% of 17354292Ki, cpu 41% of 5790m. Jenkins is running at http://jenkins.jx.35.195.140.178.nip.io\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n</code></pre>\n<h4 id=\"run-jx-console\">Run <code>jx console</code></h4>\n<!-- 2018-10-15 16:21 CEST -->\n\n<p>To know the URL of the Jenkins Dashboard, use the <code>jx console</code> command:</p>\n<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ jx console\nJenkins Console: http://jenkins.jx.35.195.140.178.nip.io/blue\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n</code></pre>\n<p>In our example, browse <a href=\"http://jenkins.jx.35.195.140.178.nip.io/blue\">http://jenkins.jx.35.195.140.178.nip.io/blue</a></p>\n<p><strong>NOTE</strong>: Jenkins login credentials (username: <code>admin</code>, password: <code>****</code>) were displayed during the installation of Jenkins X, and are stored in file <code>~/.jx/jenkinsAuth.yaml</code>.</p>\n<p>You should find three pipelines:</p>\n<ul>\n<li>gmacario/environment-howlernoon-production</li>\n<li>gmacario/environment-howlernoon-staging</li>\n<li>gmacario/node-http-hmi-repository</li>\n</ul>\n<h4 id=\"run-jx-get-build-logs\">Run <code>jx get build logs</code></h4>\n<!-- 2018-10-15 16:23 CEST -->\n\n<p>You may also inspect the logs of the Jenkins pipelines\nwith the <code>jx build logs</code> command:</p>\n<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ jx get build logs\n? Which pipeline do you want to view the logs of?:   [Use arrows to move, type to filter]\n&gt; gmacario/environment-howlernoon-production/master\n  gmacario/environment-howlernoon-staging/master\n  gmacario/node-http-hmi-repository/master\n</code></pre>\n<p>Inspect each of the above pipelines and make sure that all of them\nhave completed successfully.</p>\n<h3 id=\"preview-the-application\">Preview the application</h3>\n<!-- 2018-10-15 16:23 CEST -->\n\n<p>Use the <code>jx get environment</code> command to display the configured Jenkins X environments:</p>\n<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ jx get environment\nNAME       LABEL       KIND        PROMOTE NAMESPACE     ORDER CLUSTER SOURCE                                                            REF PR\ndev        Development Development Never   jx            0                                                              \nstaging    Staging     Permanent   Auto    jx-staging    100           https://github.com/gmacario/environment-howlernoon-staging.git\nproduction Production  Permanent   Manual  jx-production 200           https://github.com/gmacario/environment-howlernoon-production.git\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n</code></pre>\n<h4 id=\"preview-the-staging-environment\">Preview the staging environment</h4>\n<!-- 2018-10-15 16:23 CEST -->\n\n<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ jx open --env staging\nName                     URL\nnode-http-hmi-repository http://node-http-hmi-repository.jx-staging.35.195.140.178.nip.io\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n</code></pre>\n<p>then browse the URL corresponding to service <code>node-http-hmi-repository</code> -\nin our case, <a href=\"http://node-http-hmi-repository.jx-staging.35.195.140.178.nip.io\">http://node-http-hmi-repository.jx-staging.35.195.140.178.nip.io</a></p>\n<p>Alternatively:</p>\n<p>Browse GCP Console &gt; Kubernetes Engine &gt; Services</p>\n<p>In tab &quot;Kubernetes services&quot;, filter by &quot;Service Type: Ingress&quot;</p>\n<p>Browse the staging environment of &quot;node-http-hmi-repository&quot; at\n<a href=\"http://node-http-hmi-repository.jx-staging.35.195.140.178.nip.io/\">http://node-http-hmi-repository.jx-staging.35.195.140.178.nip.io/</a></p>\n<h4 id=\"preview-the-production-environment\">Preview the production environment</h4>\n<p>For the time being no applications have been deployed to the production environment:</p>\n<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ jx open --env production\nName URL\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n</code></pre>\n<p>As demonstrated by the <code>jx get environment</code> command above,\nthe deployment to the production environment is configured to be performed manually.</p>\n<h3 id=\"typical-application-development-workflow\">Typical application development workflow</h3>\n<h4 id=\"create-an-issue-to-node-http-hmi-repository\">Create an issue to node-http-hmi-repository</h4>\n<!-- 2018-10-12 17:21 CEST -->\n\n<p>Logged as gmacario@cloudshell</p>\n<pre><code class=\"language-shell\">cd ~/node-http-hmi-repository\njx create issue -t &quot;Change message on the homepage&quot;\n</code></pre>\n<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ cd node-http-hmi-repository/\ngmacario@cloudshell:~/node-http-hmi-repository (kubernetes-workshop-218213)$ jx create issue -t &quot;Change message on the homepage&quot;\n? Do you wish to use gmacario as the user name to use for authenticating with git issues Yes\n\nCreated issue #1 at https://github.com/gmacario/node-http-hmi-repository/issues/1\ngmacario@cloudshell:~/node-http-hmi-repository (kubernetes-workshop-218213)$\n</code></pre>\n<p>Double check: <a href=\"https://github.com/gmacario/node-http-hmi-repository/issues\">https://github.com/gmacario/node-http-hmi-repository/issues</a></p>\n<h4 id=\"create-a-development-branch\">Create a development branch</h4>\n<!-- 2018-10-12 17:23 CEST -->\n\n<p>Now let us switch to a branch where we can work on fixing the issue</p>\n<pre><code class=\"language-shell\">git checkout -b feature/update-index\nvi index.html\ngit add index.html\ngit commit -a -m &quot;index.html: Update text - fixes #1&quot;\ngit push -u origin feature/update-index\n</code></pre>\n<p>Now if we installed the &quot;<a href=\"https://hub.github.com/\">hub</a>&quot; tool,\nwe could create a Pull Request directly from the Command Line.\nOtherwise we can just do it from the GitHub web interface.</p>\n<h4 id=\"create-a-pull-request-to-node-http-hmi-repository\">Create a Pull Request to node-http-hmi-repository</h4>\n<p>Browse <a href=\"https://github.com/gmacario/node-http-hmi-repository\">https://github.com/gmacario/node-http-hmi-repository</a>\nand create a Pull Request from the branch you have just pushed</p>\n<p>From <a href=\"https://github.com/gmacario/node-http-hmi-repository/pull/2\">https://github.com/gmacario/node-http-hmi-repository/pull/2</a></p>\n<blockquote>\n<p>PR built and available in a preview environment <strong>gmacario-node-http-hmi-repository-pr-2</strong> <a href=\"http://node-http-hmi-repository.jx-gmacario-node-http-hmi-repository-pr-2.35.195.52.165.nip.io/\">here</a></p>\n</blockquote>\n<p>After the PR is merged to master, the change will be deployed to the staging environment.</p>\n<p>You may verify the progress of the pipelines with the following command</p>\n<pre><code class=\"language-shell\">jx get build logs\n</code></pre>\n<!-- 2018-10-15 09:26 CEST -->\n\n<p>If we run the <code>jx get apps</code> command, we can see that version 0.0.2 has been deployed to the staging environment:</p>\n<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ jx get apps\nAPPLICATION              STAGING PODS URL                                                             PRODUCTION PODS URL\nnode-http-hmi-repository 0.0.2   1/1  http://node-http-hmi-repository.jx-staging.35.195.52.165.nip.io\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n</code></pre>\n<p>List the services in the development environment:</p>\n<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ jx open\nName                      URL\njenkins                   http://jenkins.jx.35.195.52.165.nip.io\njenkins-x-chartmuseum     http://chartmuseum.jx.35.195.52.165.nip.io\njenkins-x-docker-registry http://docker-registry.jx.35.195.52.165.nip.io\njenkins-x-monocular-api   http://monocular.jx.35.195.52.165.nip.io\njenkins-x-monocular-ui    http://monocular.jx.35.195.52.165.nip.io\nnexus                     http://nexus.jx.35.195.52.165.nip.io\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n</code></pre>\n<p>List the services in the staging environment:</p>\n<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ jx open --env staging\nName                     URL\nnode-http-hmi-repository http://node-http-hmi-repository.jx-staging.35.195.52.165.nip.io\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n</code></pre>\n<p>List the services in the production environment:</p>\n<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ jx open --env production\nName URL\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n</code></pre>\n<!-- 2018-10-15 09:58 CEST -->\n\n<p>Display the activities for application &quot;node-http-hmi-repository&quot;</p>\n<pre><code class=\"language-shell\">jx get activity -f node-http-hmi-repository\n</code></pre>\n<p>Result:</p>\n<pre><code>gmacario@cloudshell:~/node-http-hmi-repository (kubernetes-workshop-218213)$ jx get activity -f node-http-hmi-repository\nSTEP                                                        STARTED AGO DURATION STATUS\ngmacario/node-http-hmi-repository/master #1                    65h2m37s    6m19s Succeeded Version: 0.0.1\n  Checkout Source                                              65h1m46s      11s Succeeded\n  CI Build and push snapshot                                   65h1m35s          NotExecuted\n  Build Release                                                65h1m34s    1m11s Succeeded\n  Promote to Environments                                      65h0m23s     4m4s Succeeded\n  Promote: staging                                            64h59m55s    3m29s Succeeded\n    PullRequest                                               64h59m55s     2m7s Succeeded  PullRequest: https://github.com/gmacario/environment-craftersaber-staging/pull/1 Merge SHA: f6c065ce56e1eb0e9f63def06b3cea2f9934c15a\n    Update                                                    64h57m48s    1m22s Succeeded  Status: Success at: http://jenkins.jx.35.195.52.165.nip.io/job/gmacario/job/environment-craftersaber-staging/job/master/4/display/redirect\n    Promoted                                                  64h57m48s    1m22s Succeeded  Application is at: http://node-http-hmi-repository.jx-staging.35.195.52.165.nip.io\n  Clean up                                                    64h56m19s       1s Succeeded\ngmacario/node-http-hmi-repository/master #2                    64h28m3s    4m25s Succeeded Version: 0.0.2\n  Checkout Source                                             64h27m35s       8s Succeeded\n  CI Build and push snapshot                                  64h27m27s          NotExecuted\n  Build Release                                               64h27m26s      47s Succeeded\n  Promote to Environments                                     64h26m39s     3m1s Succeeded\n  Promote: staging                                            64h26m12s    2m28s Succeeded\n    PullRequest                                               64h26m12s    1m26s Succeeded  PullRequest: https://github.com/gmacario/environment-craftersaber-staging/pull/2 Merge SHA: 032d965749c9abb38a1a17da94e71e0530413848\n    Update                                                    64h24m46s     1m2s Succeeded  Status: Success at: http://jenkins.jx.35.195.52.165.nip.io/job/gmacario/job/environment-craftersaber-staging/job/master/5/display/redirect\n    Promoted                                                  64h24m46s     1m2s Succeeded  Application is at: http://node-http-hmi-repository.jx-staging.35.195.52.165.nip.io\n  Clean up                                                    64h23m38s       0s Succeeded\ngmacario/node-http-hmi-repository/PR-2 #1                     64h31m13s    1m43s Succeeded\n  Checkout Source                                             64h30m45s       8s Succeeded\n  CI Build and push snapshot                                  64h30m37s     1m7s Succeeded\n  Preview                                                     64h29m31s           https://github.com/gmacario/node-http-hmi-repository/pull/2\n    Preview Application                                       64h29m31s           http://node-http-hmi-repository.jx-gmacario-node-http-hmi-repository-pr-2.35.195.52.165.nip.io\n  Build Release                                               64h29m30s          NotExecuted\n  Promote to Environments                                     64h29m30s          NotExecuted\n  Clean up                                                    64h29m30s       0s Succeeded\ngmacario@cloudshell:~/node-http-hmi-repository (kubernetes-workshop-218213)$\n</code></pre>\n<h4 id=\"creating-a-devpod\">Creating a devpod</h4>\n<!-- 2018-10-15 10:18 CEST -->\n\n<pre><code class=\"language-shell\">jx create devpod\n</code></pre>\n<p>Result:</p>\n<pre><code>gmacario@cloudshell:~/node-http-hmi-repository (kubernetes-workshop-218213)$ jx create devpod\nInstalling the ExposecontrollerService in the namespace: jx-edit-gmacario\nUpdating Helm repository...\nUsing helmBinary helm with feature flag: none\nHelm repository update done.\nCreating a DevPod of label: nodejs\nCreated pod gmacario-nodejs - waiting for it to be ready...\nUpdating Helm repository...\nHelm repository update done.\nPod gmacario-nodejs is now ready!\nYou can open other shells into this DevPod via jx create devpod\nYou can edit your app using Theia (a browser based IDE) at http://gmacario-nodejs-theia.jx.35.195.52.165.nip.io\nPort 80 is open on [http://gmacario-nodejs-port-3000.jx.35.195.52.165.nip.io http://gmacario-nodejs-port-9229.jx.35.195.52.165.nip.io] and forwarded to the devpod\nInstalling Bash Completion into DevPod\nDefaulting container name to nodejs.\nUse &#39;kubectl describe pod/gmacario-nodejs -n jx&#39; to see all of the containers in this pod.\nGenerated Git credentials file /home/jenkins/git/credentials\nCloning into &#39;node-http-hmi-repository&#39;...\nremote: Enumerating objects: 62, done.\nremote: Counting objects: 100% (62/62), done.\nremote: Compressing objects: 100% (40/40), done.\nremote: Total 62 (delta 15), reused 60 (delta 14), pack-reused 0\nUnpacking objects: 100% (62/62), done.\nChecking connectivity... done.\n[root@gmacario-nodejs node-http-hmi-repository]#\n</code></pre>\n<p>The command has now opened a devshell in my devpod.\nIt&#39;s a bit like ssh-ing into my devpod.</p>\n<p>If I now type <code>docker ps</code> I will list the containers running on my Kubernetes cluster:</p>\n<pre><code>[root@gmacario-nodejs node-http-hmi-repository]# docker ps\nCONTAINER ID        IMAGE                                                 COMMAND                  CREATED             STATUS              PORTS               NAMES\n4879c689cac6        jenkinsxio/builder-nodejs                             &quot;/bin/sh -c cat&quot;         10 minutes ago      Up 10 minutes                           k8s_nodejs_gmacario-nodejs_jx_1292aab6-d053-11e8-a13f-42010a84007c_0\n46c0a72de1a3        jenkinsxio/exposecontroller                           &quot;/exposecontroller -…&quot;   12 minutes ago      Up 12 minutes                           k8s_exposecontroller-service_exposecontroller-service-6b5bf9cc68-h47br_jx-edit-gmacario_127c8a9b-d053-11e8-a13f-42010a84007c_0\n6a3012ffa069        k8s.gcr.io/pause-amd64:3.1                            &quot;/pause&quot;                 12 minutes ago      Up 12 minutes                           k8s_POD_gmacario-nodejs_jx_1292aab6-d053-11e8-a13f-42010a84007c_0\n019cba949c7b        k8s.gcr.io/pause-amd64:3.1                            &quot;/pause&quot;                 12 minutes ago      Up 12 minutes                           k8s_POD_exposecontroller-service-6b5bf9cc68-h47br_jx-edit-gmacario_127c8a9b-d053-11e8-a13f-42010a84007c_0\na5349f2f3e1e        055e8e6ae33a                                          &quot;/monitor --stackdri…&quot;   2 days ago          Up 2 days                               k8s_prometheus-to-sd-exporter_fluentd-gcp-v3.1.0-l9swq_kube-system_1f1ac6d2-ceab-11e8-a13f-42010a84007c_0\n6952d5766cc4        gcr.io/stackdriver-agents/stackdriver-logging-agent   &quot;/entrypoint.sh /usr…&quot;   2 days ago          Up 2 days                               k8s_fluentd-gcp_fluentd-gcp-v3.1.0-l9swq_kube-system_1f1ac6d2-ceab-11e8-a13f-42010a84007c_0\n06794ae76980        k8s.gcr.io/pause-amd64:3.1                            &quot;/pause&quot;                 2 days ago          Up 2 days                               k8s_POD_fluentd-gcp-v3.1.0-l9swq_kube-system_1f1ac6d2-ceab-11e8-a13f-42010a84007c_0\n4919cf79de07        380b233f1574                                          &quot;/bin/sh -c &#39;exec ku…&quot;   2 days ago          Up 2 days                               k8s_kube-proxy_kube-proxy-gke-craftersaber-default-pool-9203d5e5-xkws_kube-system_0cfe54e72c47cb3c4efc7f396ebbda85_0\nd0543cb37dfa        k8s.gcr.io/pause-amd64:3.1                            &quot;/pause&quot;                 2 days ago          Up 2 days                               k8s_POD_kube-proxy-gke-craftersaber-default-pool-9203d5e5-xkws_kube-system_0cfe54e72c47cb3c4efc7f396ebbda85_0\n[root@gmacario-nodejs node-http-hmi-repository]#\n</code></pre>\n<p>This command has also run the <code>ksync</code> command.\n<a href=\"https://vapor-ware.github.io/ksync\">Ksync</a> is an open source tool which syncs files from your local system to a specific container running in a Kubernetes cluster.</p>\n<pre><code>[root@gmacario-nodejs node-http-hmi-repository]# pwd\n/workspace/node-http-hmi-repository\n[root@gmacario-nodejs node-http-hmi-repository]# ls -la\ntotal 84\ndrwxr-xr-x 4 root root  4096 Oct 15 08:30 .\ndrwxrwxrwx 3 root root  4096 Oct 15 08:30 ..\ndrwxr-xr-x 4 root root  4096 Oct 15 08:30 charts\n-rwxr-xr-x 1 root root   122 Oct 15 08:30 curlloop.sh\n-rw-r--r-- 1 root root    93 Oct 15 08:30 Dockerfile\n-rw-r--r-- 1 root root    43 Oct 15 08:30 .dockerignore\ndrwxr-xr-x 8 root root  4096 Oct 15 08:30 .git\n-rw-r--r-- 1 root root   884 Oct 15 08:30 .gitignore\n-rw-r--r-- 1 root root   398 Oct 15 08:30 .helmignore\n-rw-r--r-- 1 root root   193 Oct 15 08:30 index.html\n-rw-r--r-- 1 root root  2620 Oct 15 08:30 Jenkinsfile\n-rw-r--r-- 1 root root 11357 Oct 15 08:30 LICENSE\n-rw-r--r-- 1 root root    44 Oct 15 08:30 OWNERS\n-rw-r--r-- 1 root root    74 Oct 15 08:30 OWNERS_ALIASES\n-rw-r--r-- 1 root root   244 Oct 15 08:30 package.json\n-rw-r--r-- 1 root root    59 Oct 15 08:30 README.md\n-rw-r--r-- 1 root root   419 Oct 15 08:30 server.js\n-rw-r--r-- 1 root root   760 Oct 15 08:30 skaffold.yaml\n-rwxr-xr-x 1 root root   179 Oct 15 08:30 watch.sh\n[root@gmacario-nodejs node-http-hmi-repository]#\n</code></pre>\n<!-- FIXME: jx sync returns \"ksync version mismatch\" -->\n\n<pre><code class=\"language-shell\">cd ~/node-http-hmi-repository\njx sync\n</code></pre>\n<p>Result:</p>\n<pre><code>gmacario@cloudshell:~/node-http-hmi-repository (kubernetes-workshop-218213)$ jx sync\nksync is already available on your PATH at /home/gmacario/.jx/bin/ksync\nLooks like &#39;ksync watch&#39; is not running: Command failed &#39;ksync get&#39;: time=&quot;2018-10-15T11:43:28+02:00&quot; level=fatal msg=&quot;Having problems querying status. Are you running watch?&quot; exit status 1\nStarted the ksync watch\nINFO[0000] listening                                     bind=127.0.0.1 port=40322\nINFO[0003] syncthing listening                           port=8384 syncthing=localhost\n</code></pre>\n<h4 id=\"promote-to-production\">Promote to production</h4>\n<!-- 2018-10-16 10:30 CEST -->\n\n<p>The promotion to the production environment should be performed by an user with the proper permissions to create and merge Pull Request to repository <a href=\"https://github.com/gmacario/environment-howlernoon-production\">https://github.com/gmacario/environment-howlernoon-production</a></p>\n<pre><code class=\"language-shell\">cd ~/node-http-hmi-repository\ngit status\njx promote --version 0.0.3 --env production\n</code></pre>\n<p>Result:</p>\n<pre><code>gmacario@cloudshell:~/node-http-hmi-repository (kubernetes-workshop-218213)$ jx promote --version 0.0.3 --env production\nUsing helmBinary helm with feature flag: none\nPromoting app node-http-hmi-repository version 0.0.3 to namespace jx-production\npipeline gmacario/node-http-hmi-repository/master\nUsername for &#39;https://github.com&#39;: gmacario\nPassword for &#39;https://gmacario@github.com&#39;:\n? Do you wish to use gmacario as the user name to submit the Pull Request Yes\nCreated Pull Request: https://github.com/gmacario/environment-howlernoon-production/pull/2\npipeline gmacario/node-http-hmi-repository/master\nFailed to query the Pull Request last commit status for https://github.com/gmacario/environment-howlernoon-production/pull/2 ref 27758a287b0b389a43477f099d8d8d23a6f32e52 Could not find a status for repository gmacario/environment-howlernoon-production with ref 27758a287b0b389a43477f099d8d8d23a6f32e52\nFailed to query the Pull Request last commit status for https://github.com/gmacario/environment-howlernoon-production/pull/2 ref 27758a287b0b389a43477f099d8d8d23a6f32e52 Could not find a status for repository gmacario/environment-howlernoon-production with ref 27758a287b0b389a43477f099d8d8d23a6f32e52\nPull Request https://github.com/gmacario/environment-howlernoon-production/pull/2 is merged at sha 9d64dad34d425d90b846b3bfdcf5904f9ed017cd\nMerge commit has not yet any statuses on repo gmacario/environment-howlernoon-production merge sha 9d64dad34d425d90b846b3bfdcf5904f9ed017cd\nmerge status: pending for URL https://api.github.com/repos/gmacario/environment-howlernoon-production/statuses/9d64dad34d425d90b846b3bfdcf5904f9ed017cd with target: http://jenkins.jx.35.195.140.178.nip.io/job/gmacario/job/environment-howlernoon-production/job/master/3/display/redirect description: This commit is being built\nmerge status: success for URL https://api.github.com/repos/gmacario/environment-howlernoon-production/statuses/9d64dad34d425d90b846b3bfdcf5904f9ed017cd with target: http://jenkins.jx.35.195.140.178.nip.io/job/gmacario/job/environment-howlernoon-production/job/master/3/display/redirect description: This commit looks good\nMerge status checks all passed so the promotion worked!\n? Do you wish to use gmacario as the user name to comment on issues Yes\nCommenting that issue https://github.com/gmacario/node-http-hmi-repository/issues/1 is now in Production\ngmacario@cloudshell:~/node-http-hmi-repository (kubernetes-workshop-218213)$\n</code></pre>\n<p>You may follow the progress of the PR at <a href=\"https://github.com/gmacario/environment-howlernoon-production/pull/2\">https://github.com/gmacario/environment-howlernoon-production/pull/2</a></p>\n<p>Verify that release 0.0.3 of <code>node-http-hmi-repository</code> has been deployed in production:</p>\n<pre><code>gmacario@cloudshell:~/node-http-hmi-repository (kubernetes-workshop-218213)$ jx get apps -e production\nAPPLICATION              PRODUCTION PODS URL\nnode-http-hmi-repository 0.0.3      1/1  http://node-http-hmi-repository.jx-production.35.195.140.178.nip.io\ngmacario@cloudshell:~/node-http-hmi-repository (kubernetes-workshop-218213)$\n</code></pre>\n<p>Browse the production environment of &quot;node-http-hmi-repository&quot; at\n<a href=\"http://node-http-hmi-repository.jx-production.35.195.140.178.nip.io/\">http://node-http-hmi-repository.jx-production.35.195.140.178.nip.io/</a></p>\n<h3 id=\"things-which-do-not-yet-work-as-expected\">Things which do not yet work as expected</h3>\n<!-- FIXME: Browsing theia URL returns \"403 Service Unavailable\" -->\n\n<h4 id=\"browse-monocular-instance\">Browse Monocular instance</h4>\n<pre><code class=\"language-shell\">jx open\n</code></pre>\n<p>Browse <a href=\"http://monocular.jx.35.195.140.178.nip.io/\">http://monocular.jx.35.195.140.178.nip.io/</a></p>\n<p>The page seems to hang after displaying title.\nMaybe is this due to <a href=\"https://github.com/jenkins-x/jx/issues/1417\">jx issues/1417</a>?</p>\n<!--\nTODO TODO TODO\n\n```shell\njx get env\n```\n\n```shell\njx env production\n```\n\nResult:\n\n```\nTODO\n```\n-->\n\n<!--\n#### Run `TODO`\n\nCommand\n\n```shell\nTODO\n```\n\nResult\n\n```\nTODO\n```\n\nTODO TODO\n-->\n\n<h3 id=\"summary\">Summary</h3>\n<p>This article explained how to perform CI/CD of a Node.JS web application on a Kubernetes cluster using Jenkins X.</p>\n<p>Jenkins X is quite recent and therefore presents a few rough edges as the list of <a href=\"https://github.com/jenkins-x/jx/issues\">issues on GitHub</a> can testify, however it shows great potential to represent a very helpful tool for making the journey of application developers to Kubernetes smoother.</p>\n<h3 id=\"see-also\">See also</h3>\n<ul>\n<li><a href=\"https://jenkins-x.io/\">https://jenkins-x.io/</a></li>\n<li><a href=\"https://jenkins.io/projects/jenkins-x/\">https://jenkins.io/projects/jenkins-x/</a></li>\n<li><a href=\"https://youtu.be/UTKIT6STSVM\">Jenkins X: Easy CI/CD for Kubernetes - James Strachan, CloudBees (Intermediate Skill Level)</a> (YouTube Video, 34:55)</li>\n</ul>\n<!--\n* [Jenkins X - Automated CI/CD for Kubernetes](https://www.cloudbees.com/resource/webinar-recording/ondemand-webinar-easy-cicd-kubernetes/thank-you)\n-->\n\n<!-- markdown-link-check-enable -->\n<!-- EOF -->\n"},"config":{"title":"gmacario.github.io","description":"Gianpaolo Macario's public rants","social":{"github":{"name":"gmacario","link":"https://github.com/gmacario"},"twitter":{"name":"gpmacario","link":"https://www.twitter.com/gpmacario"}}}},"__N_SSG":true}