{"pageProps":{"post":{"title":"Installing OpenWrt on Kingston MLWG2","content":"<!-- markdown-link-check-disable -->\n\n<h3 id=\"introduction\">Introduction</h3>\n<p>This blog post explains how to install <a href=\"https://openwrt.org/\">OpenWrt</a> on the <a href=\"http://www.kingston.com/us/wireless/wireless_readers\">Kingston Mobilelite Wireless MLWG2</a>.</p>\n<h3 id=\"download-openwrt-image-for-mlwg2\">Download OpenWrt image for MLWG2</h3>\n<p>Download Chaos Chalmer 15.05 for mlwg2 from <a href=\"https://downloads.openwrt.org/chaos_calmer/15.05/ramips/mt7620/\">https://downloads.openwrt.org/chaos_calmer/15.05/ramips/mt7620/</a></p>\n<p>File: <a href=\"https://downloads.openwrt.org/chaos_calmer/15.05/ramips/mt7620/openwrt-15.05-ramips-mt7620-mlwg2-squashfs-sysupgrade.bin\">https://downloads.openwrt.org/chaos_calmer/15.05/ramips/mt7620/openwrt-15.05-ramips-mt7620-mlwg2-squashfs-sysupgrade.bin</a></p>\n<pre><code>gmacario@ITM-GMACARIO-W7 ~/Downloads\n$ ls -la openwrt-15.05-ramips-mt7620-mlwg2-squashfs-sysupgrade.bin\n-rwxrwx---+ 1 Administrators Domain Users 3407876 Nov 29 08:38 openwrt-15.05-ramips-mt7620-mlwg2-squashfs-sysupgrade.bin\n\ngmacario@ITM-GMACARIO-W7 ~/Downloads\n$ md5sum openwrt-15.05-ramips-mt7620-mlwg2-squashfs-sysupgrade.bin\n6948bca859a59797fc5f5978f004e11a *openwrt-15.05-ramips-mt7620-mlwg2-squashfs-sysupgrade.bin\n\ngmacario@ITM-GMACARIO-W7 ~/Downloads\n$\n</code></pre>\n<h3 id=\"prepare-the-install-media\">Prepare the install media</h3>\n<p>Plug a FAT32-formatted USB pendrive on the host and put the following files:</p>\n<pre><code>$ cd /media/xxx/\n$ touch &#39;mlwG2_v;telnetd; .x.x.bin&#39;\n$ cp ~/Downloads/openwrt-15.05-ramips-mt7620-mlwg2-squashfs-sysupgrade.bin .\n$ ls -la\n$ cd\n$ umount /media/xxx\n</code></pre>\n<p>(Optional, recommended) Connect a USB-to-serial-TTL dongle to the serial console</p>\n<table>\n<thead>\n<tr>\n<th>MLWG2 pad</th>\n<th>Signal</th>\n<th>Notes</th>\n<th>Connect to</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>+3.3Vdc</td>\n<td>Marked with a white dot</td>\n<td>DO NOT CONNECT</td>\n</tr>\n<tr>\n<td>2</td>\n<td>TX</td>\n<td>Close to R139</td>\n<td>USB-to-TTL dongle pin &quot;R&quot;</td>\n</tr>\n<tr>\n<td>3</td>\n<td>RX</td>\n<td>Close to R54</td>\n<td>USB-to-TTL dongle pin &quot;T&quot;</td>\n</tr>\n<tr>\n<td>4</td>\n<td>GND</td>\n<td>-</td>\n<td>USB-to-TTL dongle pin &quot;G&quot;</td>\n</tr>\n</tbody></table>\n<p>Launch a terminal emulator (COMx:57600,8,n,1)</p>\n<p>Plug the USB Pendrive into the USB connector of the MLWG2.</p>\n<p>Connect to Wi-Fi network &quot;MLWG2-xxxx&quot; (replace xxxx with the last two bytes of the MAC address)</p>\n<p>Then telnet to 192.168.201.254 (username:admin; password:none)</p>\n<pre><code>C:\\Users\\gmacario&gt;telnet 192.168.201.254\n\n(none) login: admin\n\nBusyBox v1.12.1 (2014-09-18 09:46:08 CST) built-in shell (ash)\nEnter &#39;help&#39; for a list of built-in commands.\n\n#\n</code></pre>\n<p>Logged as admin@mlwg2</p>\n<pre><code># mtd_write write /media/USB1/openwrt-ramips-mt7620n-mlwg2-squashfs-sysupgrade.bin KernelA\n# mtd_write -r write /media/USB1/openwrt-ramips-mt7620n-mlwg2-squashfs-sysupgrade.bin KernelB\n</code></pre>\n<p>The MLWG2 will reboot after the second command is complete.</p>\n<p>Result:</p>\n<pre><code># ls -la /media\ndrwxrwxrwx    2 0        0            4096 USB1\ndrwxr-xr-x   18 0        0               0 ..\ndrwxr-xr-x    3 0        0               0 .\n# ls -la /media/USB1\n-rwxrwxrwx    1 0        0         3407876 openwrt-15.05-ramips-mt7620-mlwg2-squ\nashfs-sysupgrade.bin\n-rwxrwxrwx    1 0        0               0 mlwG2_v;telnetd; .x.x.bin\ndrwxr-xr-x    3 0        0               0 ..\ndrwxrwxrwx    2 0        0            4096 .\n# mtd_write write /media/USB1/openwrt-15.05-ramips-mt7620-mlwg2-squashfs-sysupgr\nade.bin KernelA\nUnlocking KernelA ...\nWriting from /media/USB1/openwrt-15.05-ramips-mt7620-mlwg2-squashfs-sysupgrade.b\nin to KernelA ...  [w]\n# mtd_write -r write /media/USB1/openwrt-15.05-ramips-mt7620-mlwg2-squashfs-sysu\npgrade.bin KernelB\nUnlocking KernelB ...\nWriting from /media/USB1/openwrt-15.05-ramips-mt7620-mlwg2-squashfs-sysupgrade.b\nin to KernelB ...  [e]\n\nConnection to host lost.\n\nC:\\Users\\gmacario&gt;\n</code></pre>\n<p>Result on the serial console:</p>\n<pre><code>\nBusyBox v1.23.2 (2015-07-25 03:03:02 CEST) built-in shell (ash)\n\n  _______                     ________        __\n |       |.-----.-----.-----.|  |  |  |.----.|  |_\n |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|\n |_______||   __|_____|__|__||________||__|  |____|\n          |__| W I R E L E S S   F R E E D O M\n -----------------------------------------------------\n CHAOS CALMER (15.05, r46767)\n -----------------------------------------------------\n  * 1 1/2 oz Gin            Shake with a glassful\n  * 1/4 oz Triple Sec       of broken ice and pour\n  * 3/4 oz Lime Juice       unstrained into a goblet.\n  * 1 1/2 oz Orange Juice\n  * 1 tsp. Grenadine Syrup\n -----------------------------------------------------\nroot@OpenWrt:/# [   76.140000] random: nonblocking pool is initialized\n\nroot@OpenWrt:/#\n</code></pre>\n<p>Inspect OpenWrt configured interfaces</p>\n<pre><code>root@OpenWrt:/# ifconfig -a\nbr-lan    Link encap:Ethernet  HWaddr 00:26:B7:08:E0:A2\n          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0\n          inet6 addr: fda0:2235:dc76::1/60 Scope:Global\n          inet6 addr: fe80::226:b7ff:fe08:e0a2/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:0 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:333 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:0 (0.0 B)  TX bytes:31038 (30.3 KiB)\n\neth0      Link encap:Ethernet  HWaddr 00:26:B7:08:E0:A2\n          inet6 addr: fe80::226:b7ff:fe08:e0a2/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:0 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:138 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:0 (0.0 B)  TX bytes:14401 (14.0 KiB)\n          Interrupt:5\n\neth0.1    Link encap:Ethernet  HWaddr 00:26:B7:08:E0:A2\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:0 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:130 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:0 (0.0 B)  TX bytes:11500 (11.2 KiB)\n\nlo        Link encap:Local Loopback\n          inet addr:127.0.0.1  Mask:255.0.0.0\n          inet6 addr: ::1/128 Scope:Host\n          UP LOOPBACK RUNNING  MTU:65536  Metric:1\n          RX packets:9168 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:9168 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:623424 (608.8 KiB)  TX bytes:623424 (608.8 KiB)\n\nwlan0     Link encap:Ethernet  HWaddr 00:26:B7:08:E0:A2\n          BROADCAST MULTICAST  MTU:1500  Metric:1\n          RX packets:0 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)\n\nroot@OpenWrt:/#\n</code></pre>\n<h3 id=\"openwrt---first-login\">OpenWrt - First Login</h3>\n<p>See <a href=\"https://wiki.openwrt.org/doc/howto/firstlogin\">https://wiki.openwrt.org/doc/howto/firstlogin</a></p>\n<p>Configure your host to connect to 192.168.1.1 using the local network</p>\n<p>TODO</p>\n<h3 id=\"reconfigure-networking\">Reconfigure networking</h3>\n<p>From the serial console use the uci command to take a static IP address in your local network and use Google DNS (replace x and y appropriately)</p>\n<pre><code># uci set network.lan.netmask=255.255.255.0\n# uci set network.lan.ipaddr=192.168.x.y\n# uci set network.lan.gateway=192.168.x.z\n# uci set network.lan.broadcast=192.168.x.255\n# uci set network.lan.dns=&quot;8.8.4.4 8.8.8.8&quot;\n# uci commit network\n</code></pre>\n<p>As an alternative, directly edit file <code>/etc/config/network</code></p>\n<pre><code># vi /etc/config/network\n</code></pre>\n<p>Then restart networking</p>\n<pre><code># /etc/init.d/network restart\n</code></pre>\n<p>Verify that the network configuration has changed accordingly (in this example we had network.lan.ipaddr=192.168.64.65)</p>\n<pre><code>root@OpenWrt:/etc/config# ifconfig\nbr-lan    Link encap:Ethernet  HWaddr 00:26:B7:08:E0:A2\n          inet addr:192.168.64.65  Bcast:192.168.64.255  Mask:255.255.255.0\n          inet6 addr: fda0:2235:dc76::1/60 Scope:Global\n          inet6 addr: fe80::226:b7ff:fe08:e0a2/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:37 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:26 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:2615 (2.5 KiB)  TX bytes:2655 (2.5 KiB)\n\neth0      Link encap:Ethernet  HWaddr 00:26:B7:08:E0:A2\n          inet6 addr: fe80::226:b7ff:fe08:e0a2/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:1958 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:200 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:310839 (303.5 KiB)  TX bytes:21653 (21.1 KiB)\n          Interrupt:5\n\neth0.1    Link encap:Ethernet  HWaddr 00:26:B7:08:E0:A2\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:69 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:35 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:4919 (4.8 KiB)  TX bytes:3389 (3.3 KiB)\n\nlo        Link encap:Local Loopback\n          inet addr:127.0.0.1  Mask:255.0.0.0\n          inet6 addr: ::1/128 Scope:Host\n          UP LOOPBACK RUNNING  MTU:65536  Metric:1\n          RX packets:2064 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:2064 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:140352 (137.0 KiB)  TX bytes:140352 (137.0 KiB)\n\nroot@OpenWrt:/etc/config#\n</code></pre>\n<p>Perform some tests:</p>\n<p>From the MLWG2, try pinging another host in the same subnet - for instance, the default gateway</p>\n<pre><code># ping &lt;default_gateway_ip&gt;\n</code></pre>\n<p>Now try pinging a well known server - for instance, Google DNS</p>\n<pre><code># ping 8.8.8.8\n</code></pre>\n<p>From a Linux machine on the same subnet do a port scan of the MLWG2</p>\n<pre><code>$ sudo nmap &lt;device_ip&gt;\n</code></pre>\n<p>Stay tuned for future posts on some interesting uses of OpenWrt on my MLWG2!</p>\n<h3 id=\"see-also\">See also</h3>\n<ul>\n<li><a href=\"https://wiki.openwrt.org/toh/kingston/mlwg2\">https://wiki.openwrt.org/toh/kingston/mlwg2</a></li>\n<li><a href=\"https://github.com/gmacario/kingston-mlwg2-hack/wiki/Login-to-a-command-shell-on-MLWG2\">https://github.com/gmacario/kingston-mlwg2-hack/wiki/Login-to-a-command-shell-on-MLWG2</a></li>\n</ul>\n<!-- markdown-link-check-enable -->\n<!-- EOF -->\n"},"config":{"title":"gmacario.github.io","description":"Gianpaolo Macario's public rants","social":{"github":{"name":"gmacario","link":"https://github.com/gmacario"},"twitter":{"name":"gpmacario","link":"https://www.twitter.com/gpmacario"}}}},"__N_SSG":true}