<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="description" content="Gianpaolo Macario&#x27;s public rants"/><title>Deploying WordPress and MySQL with Persistent Volumes on GKE</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/08fafe92abad983f984c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/08fafe92abad983f984c.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.1a5e6c0bcaecf178eee2.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.a817edd9b2693fcc6af8.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-daaff4f95c13923f49a5.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-041b1432faef8bf5f62a.js" as="script"/><link rel="preload" href="/_next/static/chunks/b38cc82cec06c0ea8b096def674947a423bb2764.260eb1ac110a53311620.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-1c9a30b06d2f3be2ac9c.js" as="script"/></head><body><div id="__next"><main class="h-screen flex flex-col"><header class="py-3 fixed top-0 z-50 flex flex-wrap justify-between w-screen bg-white border-b border-gray-200"><div class="mx-3 py-2 px-4  font-bold text-indigo-500">Gianpaolo Macario&#x27;s blog</div><div class="justify-end"><a class="mr-6 py-2 px-4 inline-block rounded h-full text-indigo-500 hover:text-white hover:bg-indigo-500" href="/">Home</a><a class="mr-6 py-2 px-4 inline-block rounded h-full text-indigo-500 hover:text-white hover:bg-indigo-500" href="/posts">Posts</a></div></header><div class="pt-28 mx-auto w-5/6 break-words flex flex-grow prose prose-indigo hover:prose-black md:prose-lg lg:prose-xl"><article><h1>Deploying WordPress and MySQL with Persistent Volumes on GKE</h1><div class="prose prose-indigo hover:prose-black md:prose-lg lg:prose-xl"><!-- markdown-link-check-disable -->

<!-- 2018-10-16 12:29 CEST -->

<p>This article explains how to set up a single-replica <a href="https://wordpress.com/">WordPress</a> deployment
and a single-replica <a href="https://www.mysql.com/">MySQL</a> database on your <a href="https://kubernetes.io/">Kubernetes</a> cluster
on the <a href="https://console.cloud.google.com/">Google Cloud Platform</a>.</p>
<p>Both applications use <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/persistent-volumes">PersistentVolumes</a> (PV)
and <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/persistent-volumes">PersistentVolumeClaims</a> (PVC) to store data.</p>
<p><strong>NOTE</strong>: This deployment is not meant for production use cases as it uses single instance WordPress and MySQL Pods.
I will discuss how to deploy a redundant configuration of web front-end and database in a future post.</p>
<h3 id="references">References</h3>
<p>The instructions documented in this article were based on the following resources:</p>
<ul>
<li><a href="https://kubernetes.io/docs/tutorials/stateful-application/mysql-wordpress-persistent-volume/">https://kubernetes.io/docs/tutorials/stateful-application/mysql-wordpress-persistent-volume/</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/tutorials/persistent-disk">https://cloud.google.com/kubernetes-engine/docs/tutorials/persistent-disk</a></li>
<li><a href="https://github.com/GoogleCloudPlatform/kubernetes-engine-samples">https://github.com/GoogleCloudPlatform/kubernetes-engine-samples</a></li>
</ul>
<h3 id="prerequisites">Prerequisites</h3>
<p>Access to a <a href="https://console.cloud.google.com/kubernetes/list">Kubernetes cluster</a> already created on the Google Cloud Platform</p>
<h3 id="step-1-preparation">Step 1: Preparation</h3>
<h4 id="check-prerequisites">Check prerequisites</h4>
<p>Let us assume we have already created a GKE cluster and started a Cloud Shell</p>
<pre><code class="language-shell">gcloud config set project kubernetes-workshop-218213
gcloud container clusters get-credentials howlernoon --zone=europe-west1-b
kubectl config use-context gke_kubernetes-workshop-218213_europe-west1-b_howlernoon
kubectl get nodes
</code></pre>
<p>Result</p>
<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ kubectl get nodes
NAME                                        STATUS    ROLES     AGE       VERSION
gke-howlernoon-default-pool-844aa4f7-5n4j   Ready     &lt;none&gt;    1d        v1.9.7-gke.6
gke-howlernoon-default-pool-844aa4f7-8zxl   Ready     &lt;none&gt;    1d        v1.9.7-gke.6
gke-howlernoon-default-pool-844aa4f7-mrv2   Ready     &lt;none&gt;    1d        v1.9.7-gke.6
gmacario@cloudshell:~ (kubernetes-workshop-218213)$
</code></pre>
<h4 id="clone-kubernetes-engine-samples-repository">Clone kubernetes-engine-samples repository</h4>
<p>Logged as gmacario@cloudshell, clone the GKE samples repository:</p>
<pre><code class="language-shell">mkdir -p ~/github/GoogleCloudPlatform
cd ~/github/GoogleCloudPlatform
git clone https://github.com/GoogleCloudPlatform/kubernetes-engine-samples
cd kubernetes-engine-samples/wordpress-persistent-disks
ls -la
</code></pre>
<p>Result:</p>
<pre><code>gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ ls -la
total 36
drwxr-xr-x  2 gmacario gmacario 4096 Oct 16 15:28 .
drwxr-xr-x 13 gmacario gmacario 4096 Oct 16 15:28 ..
-rw-r--r--  1 gmacario gmacario  155 Oct 16 15:28 mysql-service.yaml
-rw-r--r--  1 gmacario gmacario  168 Oct 16 15:28 mysql-volumeclaim.yaml
-rw-r--r--  1 gmacario gmacario  787 Oct 16 15:28 mysql.yaml
-rw-r--r--  1 gmacario gmacario  152 Oct 16 15:28 README.md
-rw-r--r--  1 gmacario gmacario  209 Oct 16 15:28 wordpress-service.yaml
-rw-r--r--  1 gmacario gmacario  172 Oct 16 15:28 wordpress-volumeclaim.yaml
-rw-r--r--  1 gmacario gmacario  878 Oct 16 15:28 wordpress.yaml
gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$
</code></pre>
<h3 id="step-2-create-persistentvolumeclaims-and-persistentvolumes">Step 2: Create PersistentVolumeClaims and PersistentVolumes</h3>
<p>Logged as gmacario@cloudshell, create the PersistentVolumeClaims required for the deployments:</p>
<pre><code class="language-shell">kubectl apply -f mysql-volumeclaim.yaml
kubectl apply -f wordpress-volumeclaim.yaml
</code></pre>
<p>Contents of <code>mysql-volumeclaim.yaml</code></p>
<pre><code class="language-yaml">kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: mysql-volumeclaim
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 200Gi
</code></pre>
<p>Contents of <code>wordpress-volumeclaim.yaml</code></p>
<pre><code class="language-yaml">kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: wordpress-volumeclaim
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 200Gi
</code></pre>
<p>Result:</p>
<pre><code>gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl apply -f mysql-volumeclaim.yaml
persistentvolumeclaim &quot;mysql-volumeclaim&quot; created
gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl apply -f wordpress-volumeclaim.yaml
persistentvolumeclaim &quot;wordpress-volumeclaim&quot; created
gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$
</code></pre>
<p>Check if the claims get bound:</p>
<pre><code class="language-shell">kubectl get persistentvolumeclaims
</code></pre>
<p>Result:</p>
<pre><code>gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl get persistentvolumeclaims
NAME                    STATUS    VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
mysql-volumeclaim       Bound     pvc-b4cd3770-d147-11e8-8172-42010a8401ee   200Gi      RWO            standard       1m
wordpress-volumeclaim   Bound     pvc-be4103f6-d147-11e8-8172-42010a8401ee   200Gi      RWO            standard       1m
gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$
</code></pre>
<h3 id="step-3-set-up-mysql">Step 3: Set up MySQL</h3>
<h4 id="create-a-secret-for-mysql-password">Create a Secret for MySQL Password</h4>
<p>Logged as gmacario@cloudshell, run the following command (and replace <code>YOUR_PASSWORD</code> with a passphrase of your choice):</p>
<pre><code class="language-shell">kubectl create secret generic mysql --from-literal=password=YOUR_PASSWORD
</code></pre>
<p>Result:</p>
<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ kubectl create secret generic mysql --from-literal=password=xxxx
secret &quot;mysql&quot; created
gmacario@cloudshell:~ (kubernetes-workshop-218213)$
</code></pre>
<h4 id="deploy-mysql">Deploy MySQL</h4>
<p>Logged as gmacario@cloudshell, use the <code>mysql.yaml</code> manifest file to deploy the single instance MySQL application running on port <code>3306</code>:</p>
<pre><code class="language-shell">kubectl create -f mysql.yaml
</code></pre>
<p>Contents of <code>mysql.yaml</code></p>
<pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: mysql
  labels:
    app: mysql
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
        - image: mysql:5.6
          name: mysql
          env:
            - name: MYSQL_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mysql
                  key: password
          ports:
            - containerPort: 3306
              name: mysql
          volumeMounts:
            - name: mysql-persistent-storage
              mountPath: /var/lib/mysql
      volumes:
        - name: mysql-persistent-storage
          persistentVolumeClaim:
            claimName: mysql-volumeclaim
</code></pre>
<p>Result:</p>
<pre><code>gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl create -f mysql.yaml
deployment.extensions &quot;mysql&quot; created
gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$
</code></pre>
<p>Check that the pod is running with <code>kubectl get pods -l app=mysql</code> (it might take a few minutes):</p>
<pre><code>gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl get pods -l app=mysql
NAME                    READY     STATUS    RESTARTS   AGE
mysql-d55697945-h7thb   1/1       Running   0          1m
gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$
</code></pre>
<h4 id="create-mysql-service">Create MySQL service</h4>
<p>Logged as gmacario@cloudshell, create a Service to expose the MySQL container and make it accessible from the <code>wordpress</code> container you are going to create.</p>
<pre><code class="language-shell">kubectl create -f mysql-service.yaml
</code></pre>
<p>Contents of <code>mysql-service.yaml</code></p>
<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: mysql
  labels:
    app: mysql
spec:
  type: ClusterIP
  ports:
    - port: 3306
  selector:
    app: mysql
</code></pre>
<p>Result:</p>
<pre><code>gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl create -f mysql-service.yaml
service &quot;mysql&quot; created
gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$
</code></pre>
<p>Check to see if the Service is created</p>
<pre><code class="language-shell">kubectl get service mysql
</code></pre>
<p>Result:</p>
<pre><code>gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl get service mysql
NAME      TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
mysql     ClusterIP   10.35.247.32   &lt;none&gt;        3306/TCP   52s
gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$
</code></pre>
<h3 id="step-4-set-up-wordpress">Step 4: Set up WordPress</h3>
<h4 id="deploy-wordpress">Deploy WordPress</h4>
<p>Logged as gmacario@cloudshell</p>
<pre><code class="language-shell">kubectl create -f wordpress.yaml
</code></pre>
<p>Contents of <code>wordpress.yaml</code></p>
<pre><code class="language-yaml">apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: wordpress
  labels:
    app: wordpress
spec:
  replicas: 1
  selector:
    matchLabels:
      app: wordpress
  template:
    metadata:
      labels:
        app: wordpress
    spec:
      containers:
        - image: wordpress
          name: wordpress
          env:
          - name: WORDPRESS_DB_HOST
            value: mysql:3306
          - name: WORDPRESS_DB_PASSWORD
            valueFrom:
              secretKeyRef:
                name: mysql
                key: password
          ports:
            - containerPort: 80
              name: wordpress
          volumeMounts:
            - name: wordpress-persistent-storage
              mountPath: /var/www/html
      volumes:
        - name: wordpress-persistent-storage
          persistentVolumeClaim:
            claimName: wordpress-volumeclaim
</code></pre>
<p>Result:</p>
<pre><code>gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl create -f wordpress.yaml
deployment.extensions &quot;wordpress&quot; created
gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$
</code></pre>
<p>Type <code>kubectl get pod -l app=wordpress</code> to check if the Pod is running</p>
<pre><code>gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl get pod -l app=wordpress
NAME                         READY     STATUS    RESTARTS   AGE
wordpress-7dd5cbc5d5-tr9ht   1/1       Running   0          1m
gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$
</code></pre>
<h4 id="expose-wordpress-service">Expose WordPress service</h4>
<!-- 2018-10-16 16:35 CEST -->

<p>Logged as gmacario@cloudshell</p>
<pre><code class="language-shell">kubectl create -f wordpress-service.yaml
</code></pre>
<p>Contents of <code>wordpress-service.yaml</code></p>
<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  labels:
    app: wordpress
  name: wordpress
spec:
  type: LoadBalancer
  ports:
    - port: 80
      targetPort: 80
      protocol: TCP
  selector:
    app: wordpress
</code></pre>
<p>Result:</p>
<pre><code>gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl create -f wordpress-service.yaml
service &quot;wordpress&quot; created
gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$
</code></pre>
<p>Type <code>kubectl get svc -l app=wordpress</code> to chceck if the service is running</p>
<pre><code>gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl get svc -l app=wordpress
NAME        TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)        AGE
wordpress   LoadBalancer   10.35.240.204   35.205.34.119   80:32426/TCP   54s
gmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$
</code></pre>
<p>So the <code>wordpress</code> service will be publicly available as <a href="http://35.205.34.119:80">http://35.205.34.119:80</a></p>
<h3 id="step-5-visit-your-new-wordpress-blog">Step 5: Visit your new WordPress blog</h3>
<p>After finding out the IP address of your blog, point your browser to this IP address and you will see the WordPress installation screen as follows:</p>
<p><img src="/images/2018-10-16-wordpress-01.png" alt="wordpress-01" title="Wordpress-01"></p>
<p>Select &quot;English (United States)&quot;, then click &quot;Continue&quot;.</p>
<p><img src="/images/2018-10-16-wordpress-02.png" alt="wordpress-02" title="Wordpress-02"></p>
<p>Fill in the needed information:</p>
<ul>
<li>Site Title: TODO (example: &quot;My Wonderful WordPress site&quot;)</li>
<li>Username: TODO (example: &quot;admin&quot;)</li>
<li>Password: TODO (example: &quot;mypass&quot;)</li>
<li>Your Email: TODO (example: &quot;<a href="mailto:&#x6d;&#121;&#x75;&#x73;&#x65;&#114;&#64;&#x65;&#120;&#x61;&#x6d;&#x70;&#x6c;&#x65;&#x2e;&#x63;&#x6f;&#109;">&#x6d;&#121;&#x75;&#x73;&#x65;&#114;&#64;&#x65;&#120;&#x61;&#x6d;&#x70;&#x6c;&#x65;&#x2e;&#x63;&#x6f;&#109;</a>&quot;)</li>
<li>In section &quot;Search Engine Visibility&quot;, check &quot;Discourage search engines from indexing this site</li>
</ul>
<p>then click &quot;Install WordPress&quot;</p>
<p><img src="/images/2018-10-16-wordpress-03.png" alt="wordpress-03" title="Wordpress-03"></p>
<p>After the initial configuration of WordPress is complete, the following page will be displayed when browsing
<a href="http://35.205.34.119/">http://35.205.34.119/</a>:</p>
<p><img src="/images/2018-10-16-wordpress-04.png" alt="wordpress-04" title="Wordpress-04"></p>
<h3 id="step-6-optional-test-data-persistence-on-failure">Step 6 (Optional) Test data persistence on failure</h3>
<!-- 2018-10-17 10:43 CEST -->

<p>With PersistentVolumes, your data lives outside the application container.r
When your container becomes unavailable and gets rescheduled onto another compute
instance by Kubernetes, GKE will make the PersistentVolume available
on the instance that started running the Pod.</p>
<p>Logged as gmacario@cloudshell, watch the running pods</p>
<pre><code class="language-shell">kubectl get pods -o wide -w
</code></pre>
<p>Result:</p>
<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ kubectl get pods -o wide -w
NAME                         READY     STATUS    RESTARTS   AGE       IP           NODE
mysql-d55697945-h7thb        1/1       Running   0          18h       10.32.2.15   gke-howlernoon-default-pool-844aa4f7-5n4j
wordpress-7dd5cbc5d5-tr9ht   1/1       Running   0          18h       10.32.2.16   gke-howlernoon-default-pool-844aa4f7-5n4j
</code></pre>
<p>If from another terminal we now delete the mysql pod:</p>
<pre><code class="language-shell">kubectl delete pod -l app=mysql
</code></pre>
<p>We should observe that the Deployment controller will create the pod again.</p>
<pre><code>gmacario@cloudshell:~ (kubernetes-workshop-218213)$ kubectl get pods -o wide
NAME                         READY     STATUS    RESTARTS   AGE       IP           NODE
mysql-d55697945-f5lss        1/1       Running   0          58m       10.32.2.17   gke-howlernoon-default-pool-844aa4f7-5n4j
wordpress-7dd5cbc5d5-tr9ht   1/1       Running   0          19h       10.32.2.16   gke-howlernoon-default-pool-844aa4f7-5n4j
gmacario@cloudshell:~ (kubernetes-workshop-218213)$
</code></pre>
<h3 id="step-7-updating-application-images">Step 7: Updating application images</h3>
<p>The following commands will update the WordPress container image:</p>
<pre><code class="language-shell">cd ~/github/GoogleCloudPlatform/kubernetes-engine-samples
cd wordpress-persistent-disks
vi wordpress.yaml # Update the image: value
kubectl apply -f wordpress.yaml
</code></pre>
<p>The Deployment controller will cause a new Pod to be created, while the old one will be terminated.</p>
<h3 id="cleaning-up">Cleaning up</h3>
<p>Logged as gmacario@cloudshell, delete the <code>wordpress</code> and <code>mysql</code> services:</p>
<pre><code class="language-shell">kubectl delete service wordpress
kubectl delete service mysql
</code></pre>
<p>Wait for the Load Balancer provisioned for the <code>wordpress</code> service to be deleted:</p>
<pre><code class="language-shell">gcloud compute forwarding-rules list
</code></pre>
<p>Delete the deployments for MySQL and WordPress:</p>
<pre><code class="language-shell">kubectl delete deployment wordpress
kubectl delete deployment mysql
</code></pre>
<p>Delete the PersistentVolumeClaims for MySQL and WordPress:</p>
<pre><code class="language-shell">kubectl delete pvc wordpress-volumeclaim
kubectl delete pvc mysql-volumeclaim
</code></pre>
<p>In case you do not need the container cluster any longer,
type the following command to delete it:</p>
<pre><code class="language-shell">gcloud container clusters delete xxx
</code></pre>
<h3 id="summary">Summary</h3>
<p>This article explained how to deploy WordPress with a MySQL backend on a Kubernetes cluster on GCP.</p>
<!-- markdown-link-check-enable -->
<!-- EOF -->
</div></article></div><footer class="h-auto mt-20 bg-gray-100 justify-between border-t border-gray-200"><div class="pt-6 mx-auto  gap-x-6 w-9/12 flex flex-col prose prose-indigo hover:prose-black md:prose-lg lg:prose-xl"><div class="prose-xl"><p class="">gmacario.github.io</p></div><div class="flex flex-col sm:flex-row flex-wrap justify-between md:justify-start"><p class="mr-12 text-gray-600 prose-sm">gmacario.github.io</p><div class="mr-12 flex flex-col justify-start"><p class="text-gray-600 prose-sm flex flex-row"><svg class="MuiSvgIcon-root mr-2" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 .3a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2c-3.3.7-4-1.6-4-1.6-.6-1.4-1.4-1.8-1.4-1.8-1-.7.1-.7.1-.7 1.2 0 1.9 1.2 1.9 1.2 1 1.8 2.8 1.3 3.5 1 0-.8.4-1.3.7-1.6-2.7-.3-5.5-1.3-5.5-6 0-1.2.5-2.3 1.3-3.1-.2-.4-.6-1.6 0-3.2 0 0 1-.3 3.4 1.2a11.5 11.5 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.6 1.6.2 2.8 0 3.2.9.8 1.3 1.9 1.3 3.2 0 4.6-2.8 5.6-5.5 5.9.5.4.9 1 .9 2.2v3.3c0 .3.1.7.8.6A12 12 0 0 0 12 .3"></path></svg><a href="https://github.com/gmacario">gmacario</a></p><p class="text-gray-600 prose-sm flex flex-row"><svg class="MuiSvgIcon-root mr-2" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"></path></svg><a href="https://www.twitter.com/gpmacario">gpmacario</a></p></div><p class="mr-12 text-gray-600 prose-sm">Gianpaolo Macario&#x27;s public rants</p></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Deploying WordPress and MySQL with Persistent Volumes on GKE","content":"\u003c!-- markdown-link-check-disable --\u003e\n\n\u003c!-- 2018-10-16 12:29 CEST --\u003e\n\n\u003cp\u003eThis article explains how to set up a single-replica \u003ca href=\"https://wordpress.com/\"\u003eWordPress\u003c/a\u003e deployment\nand a single-replica \u003ca href=\"https://www.mysql.com/\"\u003eMySQL\u003c/a\u003e database on your \u003ca href=\"https://kubernetes.io/\"\u003eKubernetes\u003c/a\u003e cluster\non the \u003ca href=\"https://console.cloud.google.com/\"\u003eGoogle Cloud Platform\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eBoth applications use \u003ca href=\"https://cloud.google.com/kubernetes-engine/docs/concepts/persistent-volumes\"\u003ePersistentVolumes\u003c/a\u003e (PV)\nand \u003ca href=\"https://cloud.google.com/kubernetes-engine/docs/concepts/persistent-volumes\"\u003ePersistentVolumeClaims\u003c/a\u003e (PVC) to store data.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eNOTE\u003c/strong\u003e: This deployment is not meant for production use cases as it uses single instance WordPress and MySQL Pods.\nI will discuss how to deploy a redundant configuration of web front-end and database in a future post.\u003c/p\u003e\n\u003ch3 id=\"references\"\u003eReferences\u003c/h3\u003e\n\u003cp\u003eThe instructions documented in this article were based on the following resources:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://kubernetes.io/docs/tutorials/stateful-application/mysql-wordpress-persistent-volume/\"\u003ehttps://kubernetes.io/docs/tutorials/stateful-application/mysql-wordpress-persistent-volume/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://cloud.google.com/kubernetes-engine/docs/tutorials/persistent-disk\"\u003ehttps://cloud.google.com/kubernetes-engine/docs/tutorials/persistent-disk\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/GoogleCloudPlatform/kubernetes-engine-samples\"\u003ehttps://github.com/GoogleCloudPlatform/kubernetes-engine-samples\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"prerequisites\"\u003ePrerequisites\u003c/h3\u003e\n\u003cp\u003eAccess to a \u003ca href=\"https://console.cloud.google.com/kubernetes/list\"\u003eKubernetes cluster\u003c/a\u003e already created on the Google Cloud Platform\u003c/p\u003e\n\u003ch3 id=\"step-1-preparation\"\u003eStep 1: Preparation\u003c/h3\u003e\n\u003ch4 id=\"check-prerequisites\"\u003eCheck prerequisites\u003c/h4\u003e\n\u003cp\u003eLet us assume we have already created a GKE cluster and started a Cloud Shell\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003egcloud config set project kubernetes-workshop-218213\ngcloud container clusters get-credentials howlernoon --zone=europe-west1-b\nkubectl config use-context gke_kubernetes-workshop-218213_europe-west1-b_howlernoon\nkubectl get nodes\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eResult\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~ (kubernetes-workshop-218213)$ kubectl get nodes\nNAME                                        STATUS    ROLES     AGE       VERSION\ngke-howlernoon-default-pool-844aa4f7-5n4j   Ready     \u0026lt;none\u0026gt;    1d        v1.9.7-gke.6\ngke-howlernoon-default-pool-844aa4f7-8zxl   Ready     \u0026lt;none\u0026gt;    1d        v1.9.7-gke.6\ngke-howlernoon-default-pool-844aa4f7-mrv2   Ready     \u0026lt;none\u0026gt;    1d        v1.9.7-gke.6\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"clone-kubernetes-engine-samples-repository\"\u003eClone kubernetes-engine-samples repository\u003c/h4\u003e\n\u003cp\u003eLogged as gmacario@cloudshell, clone the GKE samples repository:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003emkdir -p ~/github/GoogleCloudPlatform\ncd ~/github/GoogleCloudPlatform\ngit clone https://github.com/GoogleCloudPlatform/kubernetes-engine-samples\ncd kubernetes-engine-samples/wordpress-persistent-disks\nls -la\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eResult:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ ls -la\ntotal 36\ndrwxr-xr-x  2 gmacario gmacario 4096 Oct 16 15:28 .\ndrwxr-xr-x 13 gmacario gmacario 4096 Oct 16 15:28 ..\n-rw-r--r--  1 gmacario gmacario  155 Oct 16 15:28 mysql-service.yaml\n-rw-r--r--  1 gmacario gmacario  168 Oct 16 15:28 mysql-volumeclaim.yaml\n-rw-r--r--  1 gmacario gmacario  787 Oct 16 15:28 mysql.yaml\n-rw-r--r--  1 gmacario gmacario  152 Oct 16 15:28 README.md\n-rw-r--r--  1 gmacario gmacario  209 Oct 16 15:28 wordpress-service.yaml\n-rw-r--r--  1 gmacario gmacario  172 Oct 16 15:28 wordpress-volumeclaim.yaml\n-rw-r--r--  1 gmacario gmacario  878 Oct 16 15:28 wordpress.yaml\ngmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"step-2-create-persistentvolumeclaims-and-persistentvolumes\"\u003eStep 2: Create PersistentVolumeClaims and PersistentVolumes\u003c/h3\u003e\n\u003cp\u003eLogged as gmacario@cloudshell, create the PersistentVolumeClaims required for the deployments:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003ekubectl apply -f mysql-volumeclaim.yaml\nkubectl apply -f wordpress-volumeclaim.yaml\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eContents of \u003ccode\u003emysql-volumeclaim.yaml\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003ekind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: mysql-volumeclaim\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 200Gi\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eContents of \u003ccode\u003ewordpress-volumeclaim.yaml\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003ekind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: wordpress-volumeclaim\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 200Gi\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eResult:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl apply -f mysql-volumeclaim.yaml\npersistentvolumeclaim \u0026quot;mysql-volumeclaim\u0026quot; created\ngmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl apply -f wordpress-volumeclaim.yaml\npersistentvolumeclaim \u0026quot;wordpress-volumeclaim\u0026quot; created\ngmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCheck if the claims get bound:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003ekubectl get persistentvolumeclaims\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eResult:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl get persistentvolumeclaims\nNAME                    STATUS    VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nmysql-volumeclaim       Bound     pvc-b4cd3770-d147-11e8-8172-42010a8401ee   200Gi      RWO            standard       1m\nwordpress-volumeclaim   Bound     pvc-be4103f6-d147-11e8-8172-42010a8401ee   200Gi      RWO            standard       1m\ngmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"step-3-set-up-mysql\"\u003eStep 3: Set up MySQL\u003c/h3\u003e\n\u003ch4 id=\"create-a-secret-for-mysql-password\"\u003eCreate a Secret for MySQL Password\u003c/h4\u003e\n\u003cp\u003eLogged as gmacario@cloudshell, run the following command (and replace \u003ccode\u003eYOUR_PASSWORD\u003c/code\u003e with a passphrase of your choice):\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003ekubectl create secret generic mysql --from-literal=password=YOUR_PASSWORD\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eResult:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~ (kubernetes-workshop-218213)$ kubectl create secret generic mysql --from-literal=password=xxxx\nsecret \u0026quot;mysql\u0026quot; created\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"deploy-mysql\"\u003eDeploy MySQL\u003c/h4\u003e\n\u003cp\u003eLogged as gmacario@cloudshell, use the \u003ccode\u003emysql.yaml\u003c/code\u003e manifest file to deploy the single instance MySQL application running on port \u003ccode\u003e3306\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003ekubectl create -f mysql.yaml\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eContents of \u003ccode\u003emysql.yaml\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eapiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: mysql\n  labels:\n    app: mysql\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: mysql\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      containers:\n        - image: mysql:5.6\n          name: mysql\n          env:\n            - name: MYSQL_ROOT_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  name: mysql\n                  key: password\n          ports:\n            - containerPort: 3306\n              name: mysql\n          volumeMounts:\n            - name: mysql-persistent-storage\n              mountPath: /var/lib/mysql\n      volumes:\n        - name: mysql-persistent-storage\n          persistentVolumeClaim:\n            claimName: mysql-volumeclaim\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eResult:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl create -f mysql.yaml\ndeployment.extensions \u0026quot;mysql\u0026quot; created\ngmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCheck that the pod is running with \u003ccode\u003ekubectl get pods -l app=mysql\u003c/code\u003e (it might take a few minutes):\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl get pods -l app=mysql\nNAME                    READY     STATUS    RESTARTS   AGE\nmysql-d55697945-h7thb   1/1       Running   0          1m\ngmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"create-mysql-service\"\u003eCreate MySQL service\u003c/h4\u003e\n\u003cp\u003eLogged as gmacario@cloudshell, create a Service to expose the MySQL container and make it accessible from the \u003ccode\u003ewordpress\u003c/code\u003e container you are going to create.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003ekubectl create -f mysql-service.yaml\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eContents of \u003ccode\u003emysql-service.yaml\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eapiVersion: v1\nkind: Service\nmetadata:\n  name: mysql\n  labels:\n    app: mysql\nspec:\n  type: ClusterIP\n  ports:\n    - port: 3306\n  selector:\n    app: mysql\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eResult:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl create -f mysql-service.yaml\nservice \u0026quot;mysql\u0026quot; created\ngmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCheck to see if the Service is created\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003ekubectl get service mysql\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eResult:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl get service mysql\nNAME      TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE\nmysql     ClusterIP   10.35.247.32   \u0026lt;none\u0026gt;        3306/TCP   52s\ngmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"step-4-set-up-wordpress\"\u003eStep 4: Set up WordPress\u003c/h3\u003e\n\u003ch4 id=\"deploy-wordpress\"\u003eDeploy WordPress\u003c/h4\u003e\n\u003cp\u003eLogged as gmacario@cloudshell\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003ekubectl create -f wordpress.yaml\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eContents of \u003ccode\u003ewordpress.yaml\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eapiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: wordpress\n  labels:\n    app: wordpress\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: wordpress\n  template:\n    metadata:\n      labels:\n        app: wordpress\n    spec:\n      containers:\n        - image: wordpress\n          name: wordpress\n          env:\n          - name: WORDPRESS_DB_HOST\n            value: mysql:3306\n          - name: WORDPRESS_DB_PASSWORD\n            valueFrom:\n              secretKeyRef:\n                name: mysql\n                key: password\n          ports:\n            - containerPort: 80\n              name: wordpress\n          volumeMounts:\n            - name: wordpress-persistent-storage\n              mountPath: /var/www/html\n      volumes:\n        - name: wordpress-persistent-storage\n          persistentVolumeClaim:\n            claimName: wordpress-volumeclaim\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eResult:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl create -f wordpress.yaml\ndeployment.extensions \u0026quot;wordpress\u0026quot; created\ngmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eType \u003ccode\u003ekubectl get pod -l app=wordpress\u003c/code\u003e to check if the Pod is running\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl get pod -l app=wordpress\nNAME                         READY     STATUS    RESTARTS   AGE\nwordpress-7dd5cbc5d5-tr9ht   1/1       Running   0          1m\ngmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"expose-wordpress-service\"\u003eExpose WordPress service\u003c/h4\u003e\n\u003c!-- 2018-10-16 16:35 CEST --\u003e\n\n\u003cp\u003eLogged as gmacario@cloudshell\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003ekubectl create -f wordpress-service.yaml\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eContents of \u003ccode\u003ewordpress-service.yaml\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eapiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: wordpress\n  name: wordpress\nspec:\n  type: LoadBalancer\n  ports:\n    - port: 80\n      targetPort: 80\n      protocol: TCP\n  selector:\n    app: wordpress\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eResult:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl create -f wordpress-service.yaml\nservice \u0026quot;wordpress\u0026quot; created\ngmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eType \u003ccode\u003ekubectl get svc -l app=wordpress\u003c/code\u003e to chceck if the service is running\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$ kubectl get svc -l app=wordpress\nNAME        TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)        AGE\nwordpress   LoadBalancer   10.35.240.204   35.205.34.119   80:32426/TCP   54s\ngmacario@cloudshell:~/github/GoogleCloudPlatform/kubernetes-engine-samples/wordpress-persistent-disks (kubernetes-workshop-218213)$\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSo the \u003ccode\u003ewordpress\u003c/code\u003e service will be publicly available as \u003ca href=\"http://35.205.34.119:80\"\u003ehttp://35.205.34.119:80\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"step-5-visit-your-new-wordpress-blog\"\u003eStep 5: Visit your new WordPress blog\u003c/h3\u003e\n\u003cp\u003eAfter finding out the IP address of your blog, point your browser to this IP address and you will see the WordPress installation screen as follows:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2018-10-16-wordpress-01.png\" alt=\"wordpress-01\" title=\"Wordpress-01\"\u003e\u003c/p\u003e\n\u003cp\u003eSelect \u0026quot;English (United States)\u0026quot;, then click \u0026quot;Continue\u0026quot;.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2018-10-16-wordpress-02.png\" alt=\"wordpress-02\" title=\"Wordpress-02\"\u003e\u003c/p\u003e\n\u003cp\u003eFill in the needed information:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSite Title: TODO (example: \u0026quot;My Wonderful WordPress site\u0026quot;)\u003c/li\u003e\n\u003cli\u003eUsername: TODO (example: \u0026quot;admin\u0026quot;)\u003c/li\u003e\n\u003cli\u003ePassword: TODO (example: \u0026quot;mypass\u0026quot;)\u003c/li\u003e\n\u003cli\u003eYour Email: TODO (example: \u0026quot;\u003ca href=\"mailto:\u0026#x6d;\u0026#121;\u0026#x75;\u0026#x73;\u0026#x65;\u0026#114;\u0026#64;\u0026#x65;\u0026#120;\u0026#x61;\u0026#x6d;\u0026#x70;\u0026#x6c;\u0026#x65;\u0026#x2e;\u0026#x63;\u0026#x6f;\u0026#109;\"\u003e\u0026#x6d;\u0026#121;\u0026#x75;\u0026#x73;\u0026#x65;\u0026#114;\u0026#64;\u0026#x65;\u0026#120;\u0026#x61;\u0026#x6d;\u0026#x70;\u0026#x6c;\u0026#x65;\u0026#x2e;\u0026#x63;\u0026#x6f;\u0026#109;\u003c/a\u003e\u0026quot;)\u003c/li\u003e\n\u003cli\u003eIn section \u0026quot;Search Engine Visibility\u0026quot;, check \u0026quot;Discourage search engines from indexing this site\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ethen click \u0026quot;Install WordPress\u0026quot;\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2018-10-16-wordpress-03.png\" alt=\"wordpress-03\" title=\"Wordpress-03\"\u003e\u003c/p\u003e\n\u003cp\u003eAfter the initial configuration of WordPress is complete, the following page will be displayed when browsing\n\u003ca href=\"http://35.205.34.119/\"\u003ehttp://35.205.34.119/\u003c/a\u003e:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/2018-10-16-wordpress-04.png\" alt=\"wordpress-04\" title=\"Wordpress-04\"\u003e\u003c/p\u003e\n\u003ch3 id=\"step-6-optional-test-data-persistence-on-failure\"\u003eStep 6 (Optional) Test data persistence on failure\u003c/h3\u003e\n\u003c!-- 2018-10-17 10:43 CEST --\u003e\n\n\u003cp\u003eWith PersistentVolumes, your data lives outside the application container.r\nWhen your container becomes unavailable and gets rescheduled onto another compute\ninstance by Kubernetes, GKE will make the PersistentVolume available\non the instance that started running the Pod.\u003c/p\u003e\n\u003cp\u003eLogged as gmacario@cloudshell, watch the running pods\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003ekubectl get pods -o wide -w\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eResult:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~ (kubernetes-workshop-218213)$ kubectl get pods -o wide -w\nNAME                         READY     STATUS    RESTARTS   AGE       IP           NODE\nmysql-d55697945-h7thb        1/1       Running   0          18h       10.32.2.15   gke-howlernoon-default-pool-844aa4f7-5n4j\nwordpress-7dd5cbc5d5-tr9ht   1/1       Running   0          18h       10.32.2.16   gke-howlernoon-default-pool-844aa4f7-5n4j\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf from another terminal we now delete the mysql pod:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003ekubectl delete pod -l app=mysql\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe should observe that the Deployment controller will create the pod again.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egmacario@cloudshell:~ (kubernetes-workshop-218213)$ kubectl get pods -o wide\nNAME                         READY     STATUS    RESTARTS   AGE       IP           NODE\nmysql-d55697945-f5lss        1/1       Running   0          58m       10.32.2.17   gke-howlernoon-default-pool-844aa4f7-5n4j\nwordpress-7dd5cbc5d5-tr9ht   1/1       Running   0          19h       10.32.2.16   gke-howlernoon-default-pool-844aa4f7-5n4j\ngmacario@cloudshell:~ (kubernetes-workshop-218213)$\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"step-7-updating-application-images\"\u003eStep 7: Updating application images\u003c/h3\u003e\n\u003cp\u003eThe following commands will update the WordPress container image:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003ecd ~/github/GoogleCloudPlatform/kubernetes-engine-samples\ncd wordpress-persistent-disks\nvi wordpress.yaml # Update the image: value\nkubectl apply -f wordpress.yaml\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe Deployment controller will cause a new Pod to be created, while the old one will be terminated.\u003c/p\u003e\n\u003ch3 id=\"cleaning-up\"\u003eCleaning up\u003c/h3\u003e\n\u003cp\u003eLogged as gmacario@cloudshell, delete the \u003ccode\u003ewordpress\u003c/code\u003e and \u003ccode\u003emysql\u003c/code\u003e services:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003ekubectl delete service wordpress\nkubectl delete service mysql\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWait for the Load Balancer provisioned for the \u003ccode\u003ewordpress\u003c/code\u003e service to be deleted:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003egcloud compute forwarding-rules list\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDelete the deployments for MySQL and WordPress:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003ekubectl delete deployment wordpress\nkubectl delete deployment mysql\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDelete the PersistentVolumeClaims for MySQL and WordPress:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003ekubectl delete pvc wordpress-volumeclaim\nkubectl delete pvc mysql-volumeclaim\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn case you do not need the container cluster any longer,\ntype the following command to delete it:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-shell\"\u003egcloud container clusters delete xxx\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"summary\"\u003eSummary\u003c/h3\u003e\n\u003cp\u003eThis article explained how to deploy WordPress with a MySQL backend on a Kubernetes cluster on GCP.\u003c/p\u003e\n\u003c!-- markdown-link-check-enable --\u003e\n\u003c!-- EOF --\u003e\n"},"config":{"title":"gmacario.github.io","description":"Gianpaolo Macario's public rants","social":{"github":{"name":"gmacario","link":"https://github.com/gmacario"},"twitter":{"name":"gpmacario","link":"https://www.twitter.com/gpmacario"}}}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2018-10-17-deploy-wordpress-mysql-on-pvc"},"buildId":"Q_McN_beRQs2LEhUHWN09","runtimeConfig":{},"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-144e5fa6fafab6397d9c.js"></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.1a5e6c0bcaecf178eee2.js" async=""></script><script src="/_next/static/chunks/commons.a817edd9b2693fcc6af8.js" async=""></script><script src="/_next/static/chunks/main-daaff4f95c13923f49a5.js" async=""></script><script src="/_next/static/chunks/pages/_app-041b1432faef8bf5f62a.js" async=""></script><script src="/_next/static/chunks/b38cc82cec06c0ea8b096def674947a423bb2764.260eb1ac110a53311620.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-1c9a30b06d2f3be2ac9c.js" async=""></script><script src="/_next/static/Q_McN_beRQs2LEhUHWN09/_buildManifest.js" async=""></script><script src="/_next/static/Q_McN_beRQs2LEhUHWN09/_ssgManifest.js" async=""></script></body></html>