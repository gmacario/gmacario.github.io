<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="description" content="Gianpaolo Macario&#x27;s public rants"/><title>Sniffing Bluetooth Low Energy packets on Linux</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/08fafe92abad983f984c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/08fafe92abad983f984c.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.1a5e6c0bcaecf178eee2.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.a817edd9b2693fcc6af8.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-daaff4f95c13923f49a5.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-041b1432faef8bf5f62a.js" as="script"/><link rel="preload" href="/_next/static/chunks/b38cc82cec06c0ea8b096def674947a423bb2764.260eb1ac110a53311620.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-1c9a30b06d2f3be2ac9c.js" as="script"/></head><body><div id="__next"><main class="h-screen flex flex-col"><header class="py-3 fixed top-0 z-50 flex flex-wrap justify-between w-screen bg-white border-b border-gray-200"><div class="mx-3 py-2 px-4  font-bold text-indigo-500">Gianpaolo Macario&#x27;s blog</div><div class="justify-end"><a class="mr-6 py-2 px-4 inline-block rounded h-full text-indigo-500 hover:text-white hover:bg-indigo-500" href="/">Home</a><a class="mr-6 py-2 px-4 inline-block rounded h-full text-indigo-500 hover:text-white hover:bg-indigo-500" href="/posts">Posts</a></div></header><div class="pt-28 mx-auto w-5/6 break-words flex flex-grow prose prose-indigo hover:prose-black md:prose-lg lg:prose-xl"><article><h1>Sniffing Bluetooth Low Energy packets on Linux</h1><div class="prose prose-indigo hover:prose-black md:prose-lg lg:prose-xl"><p>This post explains how to capture Bluetooth Low Energy packets using Open Source tools.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>A host acting as BLE central with the following characteristics:<ul>
<li>OS: a recent Debian or Ubuntu distribution (tested on a <a href="https://www.raspberrypi.com/products/raspberry-pi-3-model-b-plus/">Raspberry Pi 3B+</a> running <a href="https://www.raspberrypi.com/software/">Raspberry Pi OS</a> bullseye)</li>
<li>Package <code>bluez-utils</code> installed</li>
<li>A Bluetooth Low Energy adapter supported by the Linux host (tested with the on-board Bluetooth interface of the Raspberry Pi)</li>
</ul>
</li>
<li><a href="https://www.wireshark.org/">Wireshark</a> installed either on the Linux host or on another machine (in this case the OS may also be Windows or macOS)</li>
</ul>
<h2 id="step-by-step-instructions">Step-by-step instructions</h2>
<p>Launch <code>btmon</code> on the host acting as BLE central. In our example, open a terminal on the Raspberry Pi and type the following command:</p>
<pre><code class="language-bash">sudo btmon -w btmon-$(date &#39;+%Y%m%d-%H%M&#39;).log
</code></pre>
<p>This command will create a timestamped file, for instance <code>btmon-20230422-1600.log</code>.
The format of the file is similar to
<a href="https://source.android.com/docs/core/connect/bluetooth/verifying_debugging">Android btsnoop_hci.log</a>.</p>
<p>Now open another terminal and interact with the BLE device of interest.
For instance, launch <code>bluetoothctl</code></p>
<pre><code class="language-bash">bluetoothctl
</code></pre>
<p>and type the following commands:</p>
<pre><code class="language-bash">scan on
scan off
connect D0:99:BC:DA:66:9F
connect D0:99:BC:DA:66:9F
exit
</code></pre>
<p>Result:</p>
<pre><code class="language-text">pi@rpi3pgm29:~ $ bluetoothctl
Agent registered
[bluetooth]# scan on
Discovery started
[CHG] Controller B8:27:EB:A3:CA:84 Discovering: yes
[NEW] Device 32:EA:0A:94:14:46 32-EA-0A-94-14-46
[NEW] Device 4B:D7:0C:ED:9A:9F 4B-D7-0C-ED-9A-9F
[CHG] Device D0:99:BC:DA:66:9F RSSI: -47
[NEW] Device 6A:E5:9A:F9:9C:39 6A-E5-9A-F9-9C-39
[NEW] Device 67:58:28:56:38:79 67-58-28-56-38-79
[NEW] Device 3C:CA:D2:50:9A:9B 3C-CA-D2-50-9A-9B
[NEW] Device 67:28:E6:A6:14:58 67-28-E6-A6-14-58
[CHG] Device DE:13:06:8D:1A:5D RSSI: -44
[NEW] Device 4D:BC:5D:4F:7C:4E 4D-BC-5D-4F-7C-4E
[NEW] Device 4F:63:A0:CC:4E:12 4F-63-A0-CC-4E-12
[bluetooth]# scan off
Discovery stopped
[CHG] Controller B8:27:EB:A3:CA:84 Discovering: no
[CHG] Device 4F:63:A0:CC:4E:12 TxPower is nil
[CHG] Device 4F:63:A0:CC:4E:12 RSSI is nil
[CHG] Device 4D:BC:5D:4F:7C:4E TxPower is nil
[CHG] Device 4D:BC:5D:4F:7C:4E RSSI is nil
[CHG] Device DE:13:06:8D:1A:5D RSSI is nil
[CHG] Device 67:28:E6:A6:14:58 TxPower is nil
[CHG] Device 67:28:E6:A6:14:58 RSSI is nil
[CHG] Device 3C:CA:D2:50:9A:9B RSSI is nil
[CHG] Device 67:58:28:56:38:79 RSSI is nil
[CHG] Device 6A:E5:9A:F9:9C:39 TxPower is nil
[CHG] Device 6A:E5:9A:F9:9C:39 RSSI is nil
[CHG] Device D0:99:BC:DA:66:9F RSSI is nil
[CHG] Device 4B:D7:0C:ED:9A:9F TxPower is nil
[CHG] Device 4B:D7:0C:ED:9A:9F RSSI is nil
[CHG] Device 32:EA:0A:94:14:46 RSSI is nil
[bluetooth]# connect D0:99:BC:DA:66:9F
Attempting to connect to D0:99:BC:DA:66:9F
[CHG] Device D0:99:BC:DA:66:9F Connected: yes
Failed to connect: org.bluez.Error.Failed
[CHG] Device D0:99:BC:DA:66:9F Connected: no
[bluetooth]# connect D0:99:BC:DA:66:9F
Attempting to connect to D0:99:BC:DA:66:9F
[CHG] Device D0:99:BC:DA:66:9F Connected: yes
Failed to connect: org.bluez.Error.Failed
[CHG] Device D0:99:BC:DA:66:9F Connected: no
[bluetooth]# exit
pi@rpi3pgm29:~ $
</code></pre>
<p>The messages exchanged between the Bluetooth host (i.e. the Raspberry Pi) and the Bluetooth controller will be logged on the terminal where you executed the <code>btmon</code> command.</p>
<!-- TODO: Screenshot -->

<p>When you are satisfied with the results, type <code>^C</code> to stop btmon and look at the btsnoop file that has been created:</p>
<pre><code class="language-text">pi@rpi3pgm29:~ $ ls -la btmon-20230422-1600.log
-rw-r--r-- 1 root root 4690 Apr 22 16:02 btmon-20230422-1600.log
pi@rpi3pgm29:~ $
</code></pre>
<p>In our case the Raspberry Pi has no display, so we need to download file <code>btmon-20230422-1600.log</code> from a PC where we have Wireshark installed.</p>
<pre><code class="language-text">gmaca@alpha MINGW64 ~/Downloads
$ scp rpi3pgm29:btmon-20230422-1600.log .
btmon-20230422-1600.log                                               100% 4690   339.5KB/s   00:00

gmaca@alpha MINGW64 ~/Downloads
$
</code></pre>
<p>You may now open the file from Wireshark:</p>
<p><img src="../assets/2023-04-22-btmon-wireshark/2023-04-22-1628-capture.ng.png" alt="Screenshot"></p>
<p>You may apply some display filters, for instance <a href="https://www.wireshark.org/docs/dfref/b/btatt.html">btatt</a> (Bluetooth Attribute Protocol)</p>
<p>Wireshark: Analyze &gt; Display Filters...</p>
<ul>
<li>Filter: <code>btatt</code></li>
</ul>
<!-- EOF -->
</div></article></div><footer class="h-auto mt-20 bg-gray-100 justify-between border-t border-gray-200"><div class="pt-6 mx-auto  gap-x-6 w-9/12 flex flex-col prose prose-indigo hover:prose-black md:prose-lg lg:prose-xl"><div class="prose-xl"><p class="">gmacario.github.io</p></div><div class="flex flex-col sm:flex-row flex-wrap justify-between md:justify-start"><p class="mr-12 text-gray-600 prose-sm">gmacario.github.io</p><div class="mr-12 flex flex-col justify-start"><p class="text-gray-600 prose-sm flex flex-row"><svg class="MuiSvgIcon-root mr-2" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 .3a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2c-3.3.7-4-1.6-4-1.6-.6-1.4-1.4-1.8-1.4-1.8-1-.7.1-.7.1-.7 1.2 0 1.9 1.2 1.9 1.2 1 1.8 2.8 1.3 3.5 1 0-.8.4-1.3.7-1.6-2.7-.3-5.5-1.3-5.5-6 0-1.2.5-2.3 1.3-3.1-.2-.4-.6-1.6 0-3.2 0 0 1-.3 3.4 1.2a11.5 11.5 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.6 1.6.2 2.8 0 3.2.9.8 1.3 1.9 1.3 3.2 0 4.6-2.8 5.6-5.5 5.9.5.4.9 1 .9 2.2v3.3c0 .3.1.7.8.6A12 12 0 0 0 12 .3"></path></svg><a href="https://github.com/gmacario">gmacario</a></p><p class="text-gray-600 prose-sm flex flex-row"><svg class="MuiSvgIcon-root mr-2" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"></path></svg><a href="https://www.twitter.com/gpmacario">gpmacario</a></p></div><p class="mr-12 text-gray-600 prose-sm">Gianpaolo Macario&#x27;s public rants</p></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Sniffing Bluetooth Low Energy packets on Linux","content":"\u003cp\u003eThis post explains how to capture Bluetooth Low Energy packets using Open Source tools.\u003c/p\u003e\n\u003ch2 id=\"prerequisites\"\u003ePrerequisites\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eA host acting as BLE central with the following characteristics:\u003cul\u003e\n\u003cli\u003eOS: a recent Debian or Ubuntu distribution (tested on a \u003ca href=\"https://www.raspberrypi.com/products/raspberry-pi-3-model-b-plus/\"\u003eRaspberry Pi 3B+\u003c/a\u003e running \u003ca href=\"https://www.raspberrypi.com/software/\"\u003eRaspberry Pi OS\u003c/a\u003e bullseye)\u003c/li\u003e\n\u003cli\u003ePackage \u003ccode\u003ebluez-utils\u003c/code\u003e installed\u003c/li\u003e\n\u003cli\u003eA Bluetooth Low Energy adapter supported by the Linux host (tested with the on-board Bluetooth interface of the Raspberry Pi)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.wireshark.org/\"\u003eWireshark\u003c/a\u003e installed either on the Linux host or on another machine (in this case the OS may also be Windows or macOS)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"step-by-step-instructions\"\u003eStep-by-step instructions\u003c/h2\u003e\n\u003cp\u003eLaunch \u003ccode\u003ebtmon\u003c/code\u003e on the host acting as BLE central. In our example, open a terminal on the Raspberry Pi and type the following command:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003esudo btmon -w btmon-$(date \u0026#39;+%Y%m%d-%H%M\u0026#39;).log\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis command will create a timestamped file, for instance \u003ccode\u003ebtmon-20230422-1600.log\u003c/code\u003e.\nThe format of the file is similar to\n\u003ca href=\"https://source.android.com/docs/core/connect/bluetooth/verifying_debugging\"\u003eAndroid btsnoop_hci.log\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eNow open another terminal and interact with the BLE device of interest.\nFor instance, launch \u003ccode\u003ebluetoothctl\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ebluetoothctl\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eand type the following commands:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003escan on\nscan off\nconnect D0:99:BC:DA:66:9F\nconnect D0:99:BC:DA:66:9F\nexit\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eResult:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-text\"\u003epi@rpi3pgm29:~ $ bluetoothctl\nAgent registered\n[bluetooth]# scan on\nDiscovery started\n[CHG] Controller B8:27:EB:A3:CA:84 Discovering: yes\n[NEW] Device 32:EA:0A:94:14:46 32-EA-0A-94-14-46\n[NEW] Device 4B:D7:0C:ED:9A:9F 4B-D7-0C-ED-9A-9F\n[CHG] Device D0:99:BC:DA:66:9F RSSI: -47\n[NEW] Device 6A:E5:9A:F9:9C:39 6A-E5-9A-F9-9C-39\n[NEW] Device 67:58:28:56:38:79 67-58-28-56-38-79\n[NEW] Device 3C:CA:D2:50:9A:9B 3C-CA-D2-50-9A-9B\n[NEW] Device 67:28:E6:A6:14:58 67-28-E6-A6-14-58\n[CHG] Device DE:13:06:8D:1A:5D RSSI: -44\n[NEW] Device 4D:BC:5D:4F:7C:4E 4D-BC-5D-4F-7C-4E\n[NEW] Device 4F:63:A0:CC:4E:12 4F-63-A0-CC-4E-12\n[bluetooth]# scan off\nDiscovery stopped\n[CHG] Controller B8:27:EB:A3:CA:84 Discovering: no\n[CHG] Device 4F:63:A0:CC:4E:12 TxPower is nil\n[CHG] Device 4F:63:A0:CC:4E:12 RSSI is nil\n[CHG] Device 4D:BC:5D:4F:7C:4E TxPower is nil\n[CHG] Device 4D:BC:5D:4F:7C:4E RSSI is nil\n[CHG] Device DE:13:06:8D:1A:5D RSSI is nil\n[CHG] Device 67:28:E6:A6:14:58 TxPower is nil\n[CHG] Device 67:28:E6:A6:14:58 RSSI is nil\n[CHG] Device 3C:CA:D2:50:9A:9B RSSI is nil\n[CHG] Device 67:58:28:56:38:79 RSSI is nil\n[CHG] Device 6A:E5:9A:F9:9C:39 TxPower is nil\n[CHG] Device 6A:E5:9A:F9:9C:39 RSSI is nil\n[CHG] Device D0:99:BC:DA:66:9F RSSI is nil\n[CHG] Device 4B:D7:0C:ED:9A:9F TxPower is nil\n[CHG] Device 4B:D7:0C:ED:9A:9F RSSI is nil\n[CHG] Device 32:EA:0A:94:14:46 RSSI is nil\n[bluetooth]# connect D0:99:BC:DA:66:9F\nAttempting to connect to D0:99:BC:DA:66:9F\n[CHG] Device D0:99:BC:DA:66:9F Connected: yes\nFailed to connect: org.bluez.Error.Failed\n[CHG] Device D0:99:BC:DA:66:9F Connected: no\n[bluetooth]# connect D0:99:BC:DA:66:9F\nAttempting to connect to D0:99:BC:DA:66:9F\n[CHG] Device D0:99:BC:DA:66:9F Connected: yes\nFailed to connect: org.bluez.Error.Failed\n[CHG] Device D0:99:BC:DA:66:9F Connected: no\n[bluetooth]# exit\npi@rpi3pgm29:~ $\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe messages exchanged between the Bluetooth host (i.e. the Raspberry Pi) and the Bluetooth controller will be logged on the terminal where you executed the \u003ccode\u003ebtmon\u003c/code\u003e command.\u003c/p\u003e\n\u003c!-- TODO: Screenshot --\u003e\n\n\u003cp\u003eWhen you are satisfied with the results, type \u003ccode\u003e^C\u003c/code\u003e to stop btmon and look at the btsnoop file that has been created:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-text\"\u003epi@rpi3pgm29:~ $ ls -la btmon-20230422-1600.log\n-rw-r--r-- 1 root root 4690 Apr 22 16:02 btmon-20230422-1600.log\npi@rpi3pgm29:~ $\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn our case the Raspberry Pi has no display, so we need to download file \u003ccode\u003ebtmon-20230422-1600.log\u003c/code\u003e from a PC where we have Wireshark installed.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-text\"\u003egmaca@alpha MINGW64 ~/Downloads\n$ scp rpi3pgm29:btmon-20230422-1600.log .\nbtmon-20230422-1600.log                                               100% 4690   339.5KB/s   00:00\n\ngmaca@alpha MINGW64 ~/Downloads\n$\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou may now open the file from Wireshark:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"../assets/2023-04-22-btmon-wireshark/2023-04-22-1628-capture.ng.png\" alt=\"Screenshot\"\u003e\u003c/p\u003e\n\u003cp\u003eYou may apply some display filters, for instance \u003ca href=\"https://www.wireshark.org/docs/dfref/b/btatt.html\"\u003ebtatt\u003c/a\u003e (Bluetooth Attribute Protocol)\u003c/p\u003e\n\u003cp\u003eWireshark: Analyze \u0026gt; Display Filters...\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFilter: \u003ccode\u003ebtatt\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- EOF --\u003e\n"},"config":{"title":"gmacario.github.io","description":"Gianpaolo Macario's public rants","social":{"github":{"name":"gmacario","link":"https://github.com/gmacario"},"twitter":{"name":"gpmacario","link":"https://www.twitter.com/gpmacario"}}}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2023-04-22-btmon-wireshark"},"buildId":"JmMcmdIyD3oUfstahMd1E","runtimeConfig":{},"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-144e5fa6fafab6397d9c.js"></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.1a5e6c0bcaecf178eee2.js" async=""></script><script src="/_next/static/chunks/commons.a817edd9b2693fcc6af8.js" async=""></script><script src="/_next/static/chunks/main-daaff4f95c13923f49a5.js" async=""></script><script src="/_next/static/chunks/pages/_app-041b1432faef8bf5f62a.js" async=""></script><script src="/_next/static/chunks/b38cc82cec06c0ea8b096def674947a423bb2764.260eb1ac110a53311620.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-1c9a30b06d2f3be2ac9c.js" async=""></script><script src="/_next/static/JmMcmdIyD3oUfstahMd1E/_buildManifest.js" async=""></script><script src="/_next/static/JmMcmdIyD3oUfstahMd1E/_ssgManifest.js" async=""></script></body></html>